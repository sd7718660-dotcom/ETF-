<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETF Investment - Professional Trading Platform</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <!-- Chart.js for Crypto Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* CSS VARIABLES - PALETTE */
        :root {
            --primary: #00ff88; /* Neon Green */
            --secondary: #ffd700; /* Gold */
            --bg: #050505; /* Deep Black */
            --surface: #121212; /* Dark Grey */
            --danger: #ff4444; /* Red */
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --sidebar-width: 280px;
            --header-height: 70px;
        }

        /* GLOBAL STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        button {
            cursor: pointer;
            border: none;
            outline: none;
            transition: all 0.3s ease;
        }

        input, select, textarea {
            outline: none;
        }

        .allow-select {
            user-select: all;
        }

        /* AUTHENTICATION PAGES */
        #auth-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: radial-gradient(circle at center, #1a1a1a 0%, var(--bg) 100%);
            padding: 20px;
            z-index: 9999;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
        }

        .auth-card {
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.15);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .auth-form-group {
            margin-bottom: 20px;
        }

        .auth-form-group label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .auth-form-group input {
            width: 100%;
            padding: 14px;
            background: var(--bg);
            border: 2px solid #222;
            border-radius: 10px;
            color: var(--text);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .auth-form-group input:focus {
            border-color: var(--primary);
        }

        .auth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), #00cc6f);
            color: var(--bg);
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.5);
        }

        .auth-switch {
            text-align: center;
            margin-top: 25px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .auth-switch span {
            color: var(--primary);
            font-weight: bold;
            cursor: pointer;
            text-decoration: underline;
        }

        /* MAIN DASHBOARD LAYOUT */
        #main-dashboard {
            display: none;
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--surface) 0%, #0a0a0a 100%);
            border-right: 2px solid var(--primary);
            padding: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .sidebar-brand {
            text-align: center;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            margin-bottom: 25px;
        }

        .sidebar-brand h2 {
            font-size: 26px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-list {
            list-style: none;
            flex-grow: 1;
        }

        .nav-item {
            margin-bottom: 12px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            border-radius: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-link i {
            margin-right: 15px;
            font-size: 20px;
            width: 25px;
            text-align: center;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(0, 255, 136, 0.1);
            color: var(--primary);
            box-shadow: inset 0 0 10px rgba(0, 255, 136, 0.1);
        }

        .nav-link.active {
            background: var(--primary);
            color: var(--bg);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .sidebar-footer {
            padding-top: 20px;
            border-top: 1px solid rgba(0, 255, 136, 0.3);
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* HEADER */
        .header {
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            height: var(--header-height);
            background: rgba(18, 18, 18, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 999;
        }

        .header-title {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile-trigger {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--surface);
            padding: 8px 15px;
            border-radius: 30px;
            border: 1px solid var(--primary);
            cursor: pointer;
        }

        .profile-trigger:hover {
            background: rgba(0, 255, 136, 0.1);
        }

        .header-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .header-username {
            font-weight: bold;
            font-size: 14px;
        }

        /* MAIN CONTENT AREA */
        .content-area {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 40px;
            min-height: calc(100vh - var(--header-height));
        }

        /* PAGE SECTIONS */
        .page-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* DASHBOARD CARDS */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at top right, rgba(0, 255, 136, 0.1), transparent);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
            display: block;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
        }

        .stat-icon {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 40px;
            opacity: 0.1;
            color: var(--primary);
        }

        /* TABS SYSTEM */
        .tab-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            border-bottom: 1px solid #222;
            padding-bottom: 10px;
        }

        .tab-item {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s;
        }

        .tab-item.active {
            background: var(--primary);
            color: var(--bg);
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* INVESTMENT CARDS */
        .invest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .invest-card {
            background: var(--surface);
            border-radius: 15px;
            border: 1px solid #333;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .invest-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
        }

        .invest-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .invest-body {
            padding: 20px;
        }

        .invest-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .invest-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .invest-info span {
            color: var(--text-secondary);
        }

        .invest-info b {
            color: var(--primary);
        }

        .invest-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: var(--bg);
            font-weight: bold;
            border-radius: 8px;
        }

        /* CRYPTO MARKET TABLE */
        .crypto-container {
            background: var(--surface);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid #333;
        }

        .crypto-table {
            width: 100%;
            border-collapse: collapse;
        }

        .crypto-table th {
            text-align: left;
            padding: 15px;
            color: var(--primary);
            border-bottom: 2px solid #222;
        }

        .crypto-table td {
            padding: 15px;
            border-bottom: 1px solid #222;
        }

        .crypto-row:hover {
            background: rgba(255, 255, 255, 0.03);
            cursor: pointer;
        }

        .price-up { color: var(--primary); }
        .price-down { color: var(--danger); }

        /* MODALS */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 20px;
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 35px;
            position: relative;
            animation: zoomIn 0.3s ease;
        }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* PAYMENT SECTIONS IN MODAL */
        .payment-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .pay-tab {
            flex: 1;
            padding: 12px;
            background: #222;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        .pay-tab.active {
            background: var(--primary);
            color: var(--bg);
        }

        .pay-detail-box {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px dashed var(--primary);
            margin-bottom: 20px;
        }

        /* PROFILE PAGE */
        .profile-hero {
            background: linear-gradient(135deg, var(--surface) 0%, #1a1a1a 100%);
            border-radius: 25px;
            padding: 40px;
            display: flex;
            align-items: center;
            gap: 40px;
            margin-bottom: 40px;
            border: 1px solid var(--primary);
        }

        .profile-pic-container {
            position: relative;
            width: 150px;
            height: 150px;
        }

        .profile-pic {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary);
        }

        .pic-edit-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg);
            font-size: 18px;
            cursor: pointer;
        }

        .profile-meta h2 {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .profile-meta p {
            color: var(--text-secondary);
        }

        /* ADMIN PANEL SECTIONS */
        .admin-box {
            background: var(--surface);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--secondary);
        }

        .admin-box h3 {
            color: var(--secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            background: var(--bg);
            border: 1px solid #333;
            border-radius: 8px;
            color: var(--text);
        }

        .admin-btn {
            padding: 12px 25px;
            background: var(--secondary);
            color: var(--bg);
            font-weight: bold;
            border-radius: 8px;
            margin-top: 10px;
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 1024px) {
            :root {
                --sidebar-width: 80px;
            }
            .sidebar-brand h2, .nav-link span, .sidebar-footer {
                display: none;
            }
            .nav-link i {
                margin-right: 0;
                font-size: 24px;
            }
            .header {
                left: 80px;
            }
            .content-area {
                margin-left: 80px;
            }
        }

        @media (max-width: 768px) {
            :root {
                --sidebar-width: 0px;
            }
            .sidebar {
                left: -280px;
                transition: left 0.3s;
            }
            .sidebar.active {
                left: 0;
                width: 280px;
            }
            .sidebar.active .sidebar-brand h2, .sidebar.active .nav-link span, .sidebar.active .sidebar-footer {
                display: block;
            }
            .header {
                left: 0;
                padding: 0 20px;
            }
            .content-area {
                margin-left: 0;
                padding: 20px;
            }
            .mobile-menu-toggle {
                display: block !important;
            }
        }

        .mobile-menu-toggle {
            display: none;
            font-size: 24px;
            color: var(--primary);
            cursor: pointer;
        }

        /* LOADING SPINNER */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #222;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

    <!-- GLOBAL LOADER -->
    <div id="global-loader" class="loader-overlay">
        <div class="spinner"></div>
    </div>

    <!-- AUTHENTICATION SCREEN -->
    <div id="auth-screen">
        <!-- Login Form -->
        <div id="login-pane" class="auth-card">
            <div class="auth-header">
                <h1>ETF Investment</h1>
                <p>Welcome back! Login to your account.</p>
            </div>
            <div class="auth-form-group">
                <label>Mobile Number</label>
                <input type="text" id="login-phone" placeholder="Enter Mobile Number">
            </div>
            <div class="auth-form-group">
                <label>Password</label>
                <input type="password" id="login-password" placeholder="Enter Password">
            </div>
            <button class="auth-btn" onclick="handleLogin()">LOGIN</button>
            <div class="auth-switch">
                Don't have an account? <span onclick="switchAuth('register')">Register Now</span>
            </div>
        </div>

        <!-- Register Form -->
        <div id="register-pane" class="auth-card" style="display: none;">
            <div class="auth-header">
                <h1>Create Account</h1>
                <p>Start your professional trading journey.</p>
            </div>
            <div class="auth-form-group">
                <label>Full Name</label>
                <input type="text" id="reg-name" placeholder="Enter Your Name">
            </div>
            <div class="auth-form-group">
                <label>Mobile Number</label>
                <input type="text" id="reg-phone" placeholder="Enter Mobile Number">
            </div>
            <div class="auth-form-group">
                <label>Password</label>
                <input type="password" id="reg-password" placeholder="Create Password">
            </div>
            <div class="auth-form-group">
                <label>Confirm Password</label>
                <input type="password" id="reg-confirm" placeholder="Confirm Password">
            </div>
            <button class="auth-btn" onclick="handleRegister()">REGISTER</button>
            <div class="auth-switch">
                Already have an account? <span onclick="switchAuth('login')">Login Here</span>
            </div>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="main-dashboard">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-brand">
                <h2 id="brand-name">ETF Investment</h2>
            </div>
            <ul class="nav-list">
                <li class="nav-item">
                    <div class="nav-link active" onclick="showPage('home', this)">
                        <i class="fas fa-home"></i><span>Home</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="showPage('opportunity', this)">
                        <i class="fas fa-briefcase"></i><span>Opportunity</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="showPage('crypto', this)">
                        <i class="fab fa-bitcoin"></i><span>Crypto Market</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="showPage('referral', this)">
                        <i class="fas fa-users"></i><span>Referral</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="showPage('support', this)">
                        <i class="fas fa-headset"></i><span>24/7 Support</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" onclick="showPage('admin', this)">
                        <i class="fas fa-user-shield"></i><span>Admin Panel</span>
                    </div>
                </li>
            </ul>
            <div class="sidebar-footer">
                <p>© 2026 ETF INVESTMENT</p>
                <p>SQL POWERED</p>
            </div>
        </aside>

        <!-- HEADER -->
        <header class="header">
            <div class="mobile-menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </div>
            <div class="header-title" id="current-page-title">Home</div>
            <div class="header-actions">
                <div class="profile-trigger" onclick="showPage('profile')">
                    <img src="https://via.placeholder.com/150" id="header-avatar" class="header-avatar">
                    <span class="header-username" id="header-user-name">User</span>
                </div>
                <i class="fas fa-sign-out-alt" style="color: var(--danger); cursor: pointer; font-size: 20px;" onclick="handleLogout()"></i>
            </div>
        </header>

        <!-- CONTENT AREA -->
        <main class="content-area">
            
            <!-- HOME PAGE -->
            <section id="page-home" class="page-section active">
                <div class="stat-grid">
                    <div class="stat-card">
                        <span class="stat-label">Available Balance</span>
                        <div class="stat-value" id="dash-balance">₹0.00</div>
                        <i class="fas fa-wallet stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Profit</span>
                        <div class="stat-value" style="color: var(--primary);" id="dash-profit">₹0.00</div>
                        <i class="fas fa-chart-line stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Total Loss</span>
                        <div class="stat-value" style="color: var(--danger);" id="dash-loss">₹0.00</div>
                        <i class="fas fa-chart-area stat-icon"></i>
                    </div>
                </div>

                <div class="tab-bar">
                    <div class="tab-item active" onclick="switchHomeTab('featured', this)">Featured</div>
                    <div class="tab-item" onclick="switchHomeTab('news', this)">Market News</div>
                    <div class="tab-item" onclick="switchHomeTab('offers', this)">Special Offers</div>
                </div>

                <div id="tab-featured" class="tab-pane active">
                    <div class="invest-grid" id="featured-list">
                        <!-- Dynamic Featured Cards -->
                    </div>
                </div>
                <div id="tab-news" class="tab-pane">
                    <div class="invest-grid" id="news-list">
                        <!-- Dynamic News Cards -->
                    </div>
                </div>
                <div id="tab-offers" class="tab-pane">
                    <div class="invest-grid" id="offers-list">
                        <!-- Dynamic Offer Cards -->
                    </div>
                </div>
            </section>

            <!-- OPPORTUNITY PAGE -->
            <section id="page-opportunity" class="page-section">
                <h2 style="margin-bottom: 30px; color: var(--primary);">Investment Levels</h2>
                <div class="invest-grid" id="opportunity-list">
                    <!-- Dynamic Investment Opportunities -->
                </div>
            </section>

            <!-- CRYPTO MARKET PAGE -->
            <section id="page-crypto" class="page-section">
                <div class="tab-bar">
                    <div class="tab-item active" onclick="switchCryptoTab('market', this)">Live Market</div>
                    <div class="tab-item" onclick="switchCryptoTab('portfolio', this)">My Crypto Assets</div>
                </div>

                <div id="crypto-market-pane" class="tab-pane active">
                    <div class="crypto-container">
                        <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                            <input type="text" id="crypto-search" placeholder="Search Coins..." style="flex: 1; padding: 12px; background: var(--bg); border: 1px solid #333; color: white; border-radius: 8px;">
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="crypto-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Coin</th>
                                        <th>Price (USD)</th>
                                        <th>24h Change</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="crypto-body">
                                    <!-- Crypto Data Rows -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="crypto-portfolio-pane" class="tab-pane">
                    <div class="stat-grid">
                        <div class="stat-card" onclick="switchPortfolioSub('hold', this)" style="cursor: pointer; border-color: var(--primary);">
                            <span class="stat-label">Crypto Hold</span>
                            <div class="stat-value" id="hold-val">$0.00</div>
                        </div>
                        <div class="stat-card" onclick="switchPortfolioSub('etf', this)" style="cursor: pointer;">
                            <span class="stat-label">Crypto ETF</span>
                            <div class="stat-value" id="etf-val">$0.00</div>
                        </div>
                    </div>
                    <div id="portfolio-hold-list" class="invest-grid">
                        <!-- Hold Assets -->
                    </div>
                    <div id="portfolio-etf-list" class="invest-grid" style="display: none;">
                        <!-- ETF Assets -->
                    </div>
                </div>
            </section>

            <!-- REFERRAL PAGE -->
            <section id="page-referral" class="page-section">
                <div class="admin-box" style="border-color: var(--primary);">
                    <h2 style="color: var(--primary); margin-bottom: 20px;">Refer & Earn</h2>
                    <p style="margin-bottom: 20px;">Invite your friends and earn <b id="ref-bonus-text">₹0</b> or <b id="ref-perc-text">0%</b> commission on their first investment!</p>
                    
                    <div class="form-group">
                        <label>Your Referral Code</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="my-ref-code" readonly style="font-weight: bold; color: var(--primary); font-size: 20px; text-align: center;">
                            <button class="admin-btn" onclick="copyRef()">COPY</button>
                        </div>
                    </div>
                    <button class="auth-btn" onclick="shareRef()"><i class="fab fa-whatsapp"></i> SHARE ON WHATSAPP</button>
                </div>

                <div class="crypto-container">
                    <h3 style="margin-bottom: 20px;">Your Referrals</h3>
                    <table class="crypto-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Joined Date</th>
                                <th>Status</th>
                                <th>Bonus Earned</th>
                            </tr>
                        </thead>
                        <tbody id="ref-list">
                            <!-- Referral List -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SUPPORT PAGE -->
            <section id="page-support" class="page-section">
                <div class="profile-hero" style="flex-direction: column; text-align: center;">
                    <i class="fas fa-headset" style="font-size: 80px; color: var(--primary);"></i>
                    <h2>24/7 Customer Support</h2>
                    <p>We are always here to help you. Choose a support channel below.</p>
                    
                    <div id="support-channels" style="width: 100%; max-width: 400px; margin-top: 30px; display: flex; flex-direction: column; gap: 15px;">
                        <!-- Dynamic Support Numbers -->
                    </div>

                    <div style="margin-top: 40px; padding: 20px; background: rgba(0, 255, 136, 0.05); border-radius: 15px; border: 1px dashed var(--primary);">
                        <h3 style="color: var(--primary);"><i class="fas fa-shield-alt"></i> 100% Fund Safety</h3>
                        <p style="font-size: 14px; margin-top: 10px;">Your investments are backed by top-tier assets and secured with military-grade encryption.</p>
                    </div>
                </div>
            </section>

            <!-- PROFILE PAGE -->
            <section id="page-profile" class="page-section">
                <div class="profile-hero">
                    <div class="profile-pic-container">
                        <img src="https://via.placeholder.com/150" id="user-pfp" class="profile-pic">
                        <label for="pfp-input" class="pic-edit-btn"><i class="fas fa-camera"></i></label>
                        <input type="file" id="pfp-input" style="display: none;" onchange="uploadPFP(this)">
                    </div>
                    <div class="profile-meta">
                        <h2 id="user-display-name">Loading...</h2>
                        <p id="user-display-phone">Phone: Loading...</p>
                        <p id="user-display-email" style="font-size: 12px; opacity: 0.5;">ID: ...</p>
                    </div>
                </div>

                <div class="tab-bar">
                    <div class="tab-item active" onclick="switchProfileTab('wallet', this)">Wallet</div>
                    <div class="tab-item" onclick="switchProfileTab('history', this)">History</div>
                    <div class="tab-item" onclick="switchProfileTab('settings', this)">Payment Settings</div>
                </div>

                <div id="profile-wallet" class="tab-pane active">
                    <div class="stat-grid">
                        <div class="stat-card" style="border-color: var(--primary);">
                            <span class="stat-label">Wallet Balance</span>
                            <div class="stat-value" id="wallet-balance">₹0.00</div>
                            <div style="margin-top: 20px; display: flex; gap: 10px;">
                                <button class="btn-main" style="flex: 1;" onclick="openDeposit()">DEPOSIT</button>
                                <button class="btn-main" style="flex: 1; background: var(--secondary);" onclick="openWithdraw()">WITHDRAW</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="profile-history" class="tab-pane">
                    <div class="tab-bar" style="border-bottom: none;">
                        <div class="tab-item active" onclick="switchHistorySub('dep', this)" style="font-size: 12px;">Deposits</div>
                        <div class="tab-item" onclick="switchHistorySub('wd', this)" style="font-size: 12px;">Withdrawals</div>
                        <div class="tab-item" onclick="switchHistorySub('pending', this)" style="font-size: 12px;">Pending</div>
                    </div>
                    <div class="crypto-container">
                        <table class="crypto-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>ID</th>
                                </tr>
                            </thead>
                            <tbody id="history-body">
                                <!-- History Rows -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="profile-settings" class="tab-pane">
                    <div class="admin-box">
                        <h3>Update Payment Details</h3>
                        <div class="form-group">
                            <label>UPI ID (for withdrawals)</label>
                            <input type="text" id="user-upi-id" placeholder="example@upi">
                        </div>
                        <div class="form-group">
                            <label>Crypto Wallet Address (BTC/ETH/USDT)</label>
                            <input type="text" id="user-crypto-addr" placeholder="0x... or bc1...">
                        </div>
                        <button class="admin-btn" onclick="saveUserPayment()">SAVE DETAILS</button>
                    </div>
                </div>
            </section>

            <!-- ADMIN PANEL PAGE -->
            <section id="page-admin" class="page-section">
                <div id="admin-login-lock">
                    <div class="admin-box" style="max-width: 400px; margin: 100px auto; text-align: center;">
                        <h3>Admin Access Required</h3>
                        <div class="form-group">
                            <input type="password" id="admin-pass" placeholder="Enter Admin Password">
                        </div>
                        <button class="admin-btn" onclick="checkAdmin()">UNLOCK</button>
                    </div>
                </div>

                <div id="admin-content" style="display: none;">
                    <!-- Site Settings -->
                    <div class="admin-box">
                        <h3><i class="fas fa-cogs"></i> General Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Website Name</label>
                                <input type="text" id="set-site-name">
                            </div>
                            <div class="form-group">
                                <label>Primary Color</label>
                                <input type="color" id="set-primary-color">
                            </div>
                            <div class="form-group">
                                <label>Secondary Color</label>
                                <input type="color" id="set-secondary-color">
                            </div>
                        </div>
                        <button class="admin-btn" onclick="saveGeneralSettings()">UPDATE SITE</button>
                    </div>

                    <!-- Payment Config -->
                    <div class="admin-box">
                        <h3><i class="fas fa-money-check-alt"></i> Payment Configuration</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Admin UPI ID</label>
                                <input type="text" id="set-admin-upi">
                            </div>
                            <div class="form-group">
                                <label>BTC Address</label>
                                <input type="text" id="set-admin-btc">
                            </div>
                            <div class="form-group">
                                <label>ETH Address</label>
                                <input type="text" id="set-admin-eth">
                            </div>
                            <div class="form-group">
                                <label>Min Deposit (₹)</label>
                                <input type="number" id="set-min-dep">
                            </div>
                            <div class="form-group">
                                <label>Referral Bonus (₹)</label>
                                <input type="number" id="set-ref-bonus">
                            </div>
                            <div class="form-group">
                                <label>Referral Bonus (%)</label>
                                <input type="number" id="set-ref-perc">
                            </div>
                        </div>
                        <button class="admin-btn" onclick="savePaymentSettings()">SAVE CONFIG</button>
                    </div>

                    <!-- Create Card/Opportunity -->
                    <div class="admin-box">
                        <h3><i class="fas fa-plus-circle"></i> Create Content</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Type</label>
                                <select id="new-item-type">
                                    <option value="featured">Featured Card</option>
                                    <option value="news">News Card</option>
                                    <option value="offer">Offer Card</option>
                                    <option value="opportunity">Investment Opportunity</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="new-item-title">
                            </div>
                            <div class="form-group">
                                <label>Min Amount (₹)</label>
                                <input type="number" id="new-item-min">
                            </div>
                            <div class="form-group">
                                <label>ROI (%)</label>
                                <input type="number" id="new-item-roi">
                            </div>
                            <div class="form-group">
                                <label>Duration (Days)</label>
                                <input type="number" id="new-item-days">
                            </div>
                            <div class="form-group">
                                <label>Image File</label>
                                <input type="file" id="new-item-img">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description / Content</label>
                            <textarea id="new-item-desc" rows="3"></textarea>
                        </div>
                        <button class="admin-btn" onclick="createNewItem()">LAUNCH CONTENT</button>
                    </div>

                    <!-- Support Numbers -->
                    <div class="admin-box">
                        <h3><i class="fab fa-whatsapp"></i> Support Numbers</h3>
                        <div id="admin-support-list" style="margin-bottom: 15px;">
                            <!-- List of numbers -->
                        </div>
                        <div class="form-group" style="display: flex; gap: 10px;">
                            <input type="text" id="new-support-num" placeholder="+91...">
                            <button class="admin-btn" style="margin-top: 0;" onclick="addSupportNum()">ADD</button>
                        </div>
                    </div>

                    <!-- Transaction Management -->
                    <div class="admin-box">
                        <h3><i class="fas fa-tasks"></i> Pending Transactions</h3>
                        <div class="crypto-container">
                            <table class="crypto-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Hash/UTR</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-tx-body">
                                    <!-- Pending Transactions -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- MODALS -->
    
    <!-- Deposit Modal -->
    <div id="modal-deposit" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-close" onclick="closeModals()">&times;</div>
            <h2 style="color: var(--primary);">Deposit Funds</h2>
            <p style="margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">Select a package or enter a custom amount.</p>
            
            <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                <button class="pay-tab" onclick="setDepAmt(500)">₹500</button>
                <button class="pay-tab" onclick="setDepAmt(1000)">₹1000</button>
                <button class="pay-tab" onclick="setDepAmt(5000)">₹5000</button>
                <button class="pay-tab" onclick="setDepAmt(10000)">₹10k</button>
                <button class="pay-tab" onclick="setDepAmt(50000)">₹50k</button>
                <button class="pay-tab" onclick="setDepAmt(100000)">₹1L</button>
            </div>

            <div class="form-group">
                <label>Amount (₹)</label>
                <input type="number" id="dep-amount-input" placeholder="Enter Amount">
            </div>

            <div class="payment-tabs">
                <div class="pay-tab active" id="tab-upi" onclick="switchPayMethod('upi')">UPI</div>
                <div class="pay-tab" id="tab-crypto" onclick="switchPayMethod('crypto')">CRYPTO</div>
            </div>

            <div id="pay-upi-pane" class="pay-detail-box">
                <p>Pay to UPI ID:</p>
                <h3 class="allow-select" id="display-admin-upi" style="color: var(--secondary); margin: 10px 0;">loading...</h3>
                <a href="#" id="upi-link" class="btn-main" style="display: block; text-align: center; text-decoration: none; padding: 10px; border-radius: 8px; margin-top: 15px;">OPEN UPI APP</a>
            </div>

            <div id="pay-crypto-pane" class="pay-detail-box" style="display: none;">
                <p>BTC Address:</p>
                <small class="allow-select" id="display-admin-btc" style="word-break: break-all; color: var(--secondary);">loading...</small>
                <p style="margin-top: 15px;">ETH Address:</p>
                <small class="allow-select" id="display-admin-eth" style="word-break: break-all; color: var(--secondary);">loading...</small>
            </div>

            <div class="form-group">
                <label>Transaction Hash / UTR Number</label>
                <input type="text" id="dep-hash" placeholder="Enter Hash or UTR">
            </div>
            <div class="form-group">
                <label>Upload Screenshot (Optional)</label>
                <input type="file" id="dep-ss">
            </div>

            <button class="auth-btn" onclick="submitDeposit()">SUBMIT DEPOSIT</button>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="modal-withdraw" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-close" onclick="closeModals()">&times;</div>
            <h2 style="color: var(--danger);">Withdraw Funds</h2>
            <p style="margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">Your funds will be sent to your saved payment details.</p>
            
            <div class="stat-card" style="margin-bottom: 20px;">
                <span class="stat-label">Available to Withdraw</span>
                <div class="stat-value" id="wd-avail-bal">₹0.00</div>
            </div>

            <div class="form-group">
                <label>Amount to Withdraw (₹)</label>
                <input type="number" id="wd-amount" placeholder="Enter Amount">
            </div>

            <div class="pay-detail-box">
                <p>Sending to:</p>
                <p id="wd-dest" style="color: var(--primary); margin-top: 5px;">No payment details saved!</p>
            </div>

            <button class="auth-btn" style="background: var(--danger);" onclick="submitWithdrawal()">REQUEST WITHDRAWAL</button>
        </div>
    </div>

    <!-- Crypto Detail Modal -->
    <div id="modal-crypto" class="modal-overlay">
        <div class="modal-box" style="max-width: 700px;">
            <div class="modal-close" onclick="closeModals()">&times;</div>
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <img src="" id="cry-modal-icon" style="width: 40px; height: 40px;">
                <h2 id="cry-modal-name" style="color: var(--primary);">Bitcoin</h2>
            </div>

            <div style="height: 300px; margin-bottom: 25px;">
                <canvas id="crypto-chart"></canvas>
            </div>

            <div class="form-grid">
                <div class="stat-card">
                    <span class="stat-label">Price (USD)</span>
                    <div class="stat-value" id="cry-modal-price">$0.00</div>
                </div>
                <div class="stat-card">
                    <span class="stat-label">24h Change</span>
                    <div class="stat-value" id="cry-modal-change">0%</div>
                </div>
            </div>

            <div class="admin-box" style="margin-top: 25px;">
                <h3>Buy Assets</h3>
                <div class="form-group">
                    <label>Investment Type</label>
                    <select id="cry-buy-type">
                        <option value="direct">Direct Crypto Purchase</option>
                        <option value="etf">ETF-Backed Crypto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Amount (USD)</label>
                    <input type="number" id="cry-buy-amt" placeholder="Enter USD Amount">
                </div>
                <button class="auth-btn" onclick="buyCrypto()">CONFIRM PURCHASE</button>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyBvObxADcAior6R_or9O6UmWsFT8do1GkI",
            authDomain: "sqladmin-ff04d.firebaseapp.com",
            projectId: "sqladmin-ff04d",
            storageBucket: "sqladmin-ff04d.firebasestorage.app",
            messagingSenderId: "539086978850",
            appId: "1:539086978850:web:261e6a0cf3c9a2aa29ef7b"
        };

        // CLOUDINARY CONFIG
        const cloudinaryConfig = {
            uploadUrl: "https://api.cloudinary.com/v1_1/debp1kjtm/image/upload",
            uploadPreset: "sql_admin",
            folder: "sql_users"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // GLOBAL STATE
        let currentUser = null;
        let userData = null;
        let adminSettings = {};
        let cryptoData = [];
        let currentChart = null;
        let selectedCoin = null;
        let payMethod = 'upi';

        // AUTH CHECK
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                loadUserData();
            } else {
                document.getElementById('global-loader').style.display = 'none';
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('main-dashboard').style.display = 'none';
            }
        });

        // AUTH FUNCTIONS
        function switchAuth(pane) {
            document.getElementById('login-pane').style.display = pane === 'login' ? 'block' : 'none';
            document.getElementById('register-pane').style.display = pane === 'register' ? 'block' : 'none';
        }

        async function handleRegister() {
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            const pass = document.getElementById('reg-password').value;
            const confirm = document.getElementById('reg-confirm').value;

            if (!name || !phone || !pass || pass !== confirm) {
                return alert("Please check all fields!");
            }

            try {
                // Use phone as email for Firebase Auth
                const email = phone + "@etf-invest.com";
                const cred = await auth.createUserWithEmailAndPassword(email, pass);
                const user = cred.user;

                const refCode = 'ETF' + Math.random().toString(36).substr(2, 6).toUpperCase();

                await db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    name: name,
                    phone: phone,
                    email: email,
                    balance: 0,
                    profit: 0,
                    loss: 0,
                    totalInvested: 0,
                    referralCode: refCode,
                    referredBy: new URLSearchParams(window.location.search).get('ref') || '',
                    referralCount: 0,
                    referralBonus: 0,
                    upiId: '',
                    cryptoAddr: '',
                    pfp: '',
                    role: 'user',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                location.reload();
            } catch (e) {
                alert(e.message);
            }
        }

        async function handleLogin() {
            const phone = document.getElementById('login-phone').value;
            const pass = document.getElementById('login-password').value;

            if (!phone || !pass) return alert("Enter credentials!");

            try {
                const email = phone + "@etf-invest.com";
                await auth.signInWithEmailAndPassword(email, pass);
                location.reload();
            } catch (e) {
                alert("Invalid Login!");
            }
        }

        function handleLogout() {
            auth.signOut();
        }

        // DATA LOADING
        async function loadUserData() {
            db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
                if (doc.exists) {
                    userData = doc.data();
                    updateUI();
                    loadAdminSettings();
                    loadCryptoData();
                    loadContent();
                    document.getElementById('global-loader').style.display = 'none';
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('main-dashboard').style.display = 'block';
                }
            });
        }

        function loadAdminSettings() {
            db.collection('admin_settings').doc('config').onSnapshot(doc => {
                if (doc.exists) {
                    adminSettings = doc.data();
                    applyAdminSettings();
                }
            });
        }

        function applyAdminSettings() {
            if (adminSettings.siteName) {
                document.getElementById('brand-name').innerText = adminSettings.siteName;
                document.title = adminSettings.siteName;
            }
            if (adminSettings.primaryColor) document.documentElement.style.setProperty('--primary', adminSettings.primaryColor);
            if (adminSettings.secondaryColor) document.documentElement.style.setProperty('--secondary', adminSettings.secondaryColor);
            
            document.getElementById('display-admin-upi').innerText = adminSettings.adminUpi || 'Not Set';
            document.getElementById('display-admin-btc').innerText = adminSettings.adminBtc || 'Not Set';
            document.getElementById('display-admin-eth').innerText = adminSettings.adminEth || 'Not Set';
            document.getElementById('ref-bonus-text').innerText = '₹' + (adminSettings.refBonus || 0);
            document.getElementById('ref-perc-text').innerText = (adminSettings.refPerc || 0) + '%';
            
            // Support numbers
            const supportBox = document.getElementById('support-channels');
            supportBox.innerHTML = '';
            (adminSettings.supportNumbers || []).forEach(num => {
                const waLink = `https://wa.me/${num.replace(/\D/g, '')}?text=${encodeURIComponent('ETF WEBSITE से आया है')}`;
                supportBox.innerHTML += `
                    <a href="${waLink}" target="_blank" class="auth-btn" style="text-decoration: none; text-align: center;">
                        <i class="fab fa-whatsapp"></i> WhatsApp: ${num}
                    </a>
                `;
            });
        }

        function updateUI() {
            document.getElementById('header-user-name').innerText = userData.name;
            document.getElementById('user-display-name').innerText = userData.name;
            document.getElementById('user-display-phone').innerText = 'Phone: ' + userData.phone;
            document.getElementById('user-display-email').innerText = 'ID: ' + userData.uid;
            document.getElementById('dash-balance').innerText = '₹' + (userData.balance || 0).toLocaleString();
            document.getElementById('dash-profit').innerText = '₹' + (userData.profit || 0).toLocaleString();
            document.getElementById('dash-loss').innerText = '₹' + (userData.loss || 0).toLocaleString();
            document.getElementById('wallet-balance').innerText = '₹' + (userData.balance || 0).toLocaleString();
            document.getElementById('wd-avail-bal').innerText = '₹' + (userData.balance || 0).toLocaleString();
            document.getElementById('my-ref-code').value = userData.referralCode;
            document.getElementById('user-upi-id').value = userData.upiId || '';
            document.getElementById('user-crypto-addr').value = userData.cryptoAddr || '';
            document.getElementById('wd-dest').innerText = userData.upiId ? `UPI: ${userData.upiId}` : (userData.cryptoAddr ? `Crypto: ${userData.cryptoAddr}` : 'No payment details saved!');

            if (userData.pfp) {
                document.getElementById('header-avatar').src = userData.pfp;
                document.getElementById('user-pfp').src = userData.pfp;
            }
        }

        // CONTENT LOADING (CARDS & OPPORTUNITIES)
        function loadContent() {
            db.collection('content').orderBy('createdAt', 'desc').onSnapshot(snap => {
                const featured = document.getElementById('featured-list');
                const news = document.getElementById('news-list');
                const offers = document.getElementById('offers-list');
                const opps = document.getElementById('opportunity-list');

                featured.innerHTML = ''; news.innerHTML = ''; offers.innerHTML = ''; opps.innerHTML = '';

                snap.forEach(doc => {
                    const data = doc.data();
                    const card = createContentCard(data, doc.id);
                    if (data.type === 'featured') featured.appendChild(card);
                    if (data.type === 'news') news.appendChild(card);
                    if (data.type === 'offer') offers.appendChild(card);
                    if (data.type === 'opportunity') opps.appendChild(card);
                });
            });
        }

        function createContentCard(data, id) {
            const div = document.createElement('div');
            div.className = 'invest-card';
            div.innerHTML = `
                <img src="${data.image || 'https://via.placeholder.com/300x180'}" class="invest-img">
                <div class="invest-body">
                    <div class="invest-title">${data.title}</div>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">${data.desc || ''}</p>
                    ${data.type === 'opportunity' ? `
                        <div class="invest-info"><span>Min Investment:</span><b>₹${data.min}</b></div>
                        <div class="invest-info"><span>ROI:</span><b>${data.roi}%</b></div>
                        <div class="invest-info"><span>Duration:</span><b>${data.days} Days</b></div>
                        <button class="invest-btn" onclick="openDeposit(${data.min})">INVEST NOW</button>
                    ` : `<button class="invest-btn" onclick="alert('${data.title}')">LEARN MORE</button>`}
                </div>
            `;
            return div;
        }

        // CRYPTO MARKET LOGIC
        async function loadCryptoData() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&sparkline=false');
                cryptoData = await res.json();
                renderCryptoTable();
            } catch (e) {
                console.log("Crypto fetch error", e);
            }
        }

        // Update crypto prices every 10 seconds (0.01s update is too heavy for browsers/APIs, 10s is realistic for production)
        setInterval(loadCryptoData, 10000);

        function renderCryptoTable() {
            const body = document.getElementById('crypto-body');
            const search = document.getElementById('crypto-search').value.toLowerCase();
            body.innerHTML = '';

            cryptoData.filter(c => c.name.toLowerCase().includes(search) || c.symbol.toLowerCase().includes(search)).forEach((coin, i) => {
                const tr = document.createElement('tr');
                tr.className = 'crypto-row';
                tr.onclick = () => openCryptoDetail(coin);
                const change = coin.price_change_percentage_24h || 0;
                tr.innerHTML = `
                    <td>${i+1}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${coin.image}" style="width: 25px;">
                            <span>${coin.name} <small style="color: #666;">${coin.symbol.toUpperCase()}</small></span>
                        </div>
                    </td>
                    <td style="font-weight: bold;">$${coin.current_price.toLocaleString()}</td>
                    <td class="${change >= 0 ? 'price-up' : 'price-down'}">${change.toFixed(2)}%</td>
                    <td><button class="btn-main" style="padding: 5px 15px; font-size: 11px;">TRADE</button></td>
                `;
                body.appendChild(tr);
            });
        }

        document.getElementById('crypto-search').oninput = renderCryptoTable;

        function openCryptoDetail(coin) {
            selectedCoin = coin;
            document.getElementById('cry-modal-icon').src = coin.image;
            document.getElementById('cry-modal-name').innerText = coin.name;
            document.getElementById('cry-modal-price').innerText = '$' + coin.current_price.toLocaleString();
            const change = coin.price_change_percentage_24h || 0;
            document.getElementById('cry-modal-change').innerText = change.toFixed(2) + '%';
            document.getElementById('cry-modal-change').className = 'stat-value ' + (change >= 0 ? 'price-up' : 'price-down');
            
            document.getElementById('modal-crypto').classList.add('active');
            renderChart(coin);
        }

        function renderChart(coin) {
            const ctx = document.getElementById('crypto-chart').getContext('2d');
            if (currentChart) currentChart.destroy();

            // Mocking historical data for the chart
            const labels = Array.from({length: 24}, (_, i) => (23 - i) + 'h ago');
            const data = Array.from({length: 24}, () => coin.current_price * (0.95 + Math.random() * 0.1));

            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Price (USD)',
                        data: data,
                        borderColor: '#00ff88',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: true,
                        backgroundColor: 'rgba(0, 255, 136, 0.05)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { grid: { color: '#222' }, ticks: { color: '#666' } }
                    }
                }
            });
        }

        async function buyCrypto() {
            const amt = document.getElementById('cry-buy-amt').value;
            const type = document.getElementById('cry-buy-type').value;
            if (!amt || amt <= 0) return alert("Enter valid amount!");

            try {
                await db.collection('crypto_orders').add({
                    uid: currentUser.uid,
                    userName: userData.name,
                    coin: selectedCoin.name,
                    symbol: selectedCoin.symbol,
                    priceAtBuy: selectedCoin.current_price,
                    usdAmount: parseFloat(amt),
                    type: type,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Order Placed! Awaiting admin approval.");
                closeModals();
            } catch (e) { alert(e.message); }
        }

        // NAVIGATION
        function showPage(pageId, el) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            
            if (el) {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                el.classList.add('active');
            }
            
            document.getElementById('current-page-title').innerText = pageId.charAt(0).toUpperCase() + pageId.slice(1);
            if (window.innerWidth <= 768) toggleSidebar();

            if (pageId === 'admin') {
                document.getElementById('admin-login-lock').style.display = 'block';
                document.getElementById('admin-content').style.display = 'none';
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function switchHomeTab(tab, el) {
            document.querySelectorAll('#page-home .tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            document.querySelectorAll('#page-home .tab-item').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        function switchCryptoTab(tab, el) {
            document.querySelectorAll('#page-crypto .tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById('crypto-' + tab + '-pane').classList.add('active');
            document.querySelectorAll('#page-crypto .tab-item').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        function switchProfileTab(tab, el) {
            document.querySelectorAll('#page-profile .tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById('profile-' + tab).classList.add('active');
            document.querySelectorAll('#page-profile .tab-item').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        // MODAL ACTIONS
        function openDeposit(min = 0) {
            if (min) document.getElementById('dep-amount-input').value = min;
            document.getElementById('modal-deposit').classList.add('active');
        }

        function openWithdraw() {
            document.getElementById('modal-withdraw').classList.add('active');
        }

        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
        }

        function setDepAmt(val) {
            document.getElementById('dep-amount-input').value = val;
        }

        function switchPayMethod(m) {
            payMethod = m;
            document.getElementById('tab-upi').classList.toggle('active', m === 'upi');
            document.getElementById('tab-crypto').classList.toggle('active', m === 'crypto');
            document.getElementById('pay-upi-pane').style.display = m === 'upi' ? 'block' : 'none';
            document.getElementById('pay-crypto-pane').style.display = m === 'crypto' ? 'block' : 'none';
        }

        async function submitDeposit() {
            const amt = document.getElementById('dep-amount-input').value;
            const hash = document.getElementById('dep-hash').value;
            if (!amt || !hash) return alert("Fill all details!");

            try {
                await db.collection('transactions').add({
                    uid: currentUser.uid,
                    userName: userData.name,
                    amount: parseFloat(amt),
                    hash: hash,
                    type: 'deposit',
                    method: payMethod,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Deposit Submitted!");
                closeModals();
            } catch (e) { alert(e.message); }
        }

        async function submitWithdrawal() {
            const amt = document.getElementById('wd-amount').value;
            if (!amt || amt <= 0) return alert("Enter amount!");
            if (amt > userData.balance) return alert("Insufficient Balance!");
            if (!userData.upiId && !userData.cryptoAddr) return alert("Save payment details first!");

            try {
                await db.collection('transactions').add({
                    uid: currentUser.uid,
                    userName: userData.name,
                    amount: parseFloat(amt),
                    type: 'withdrawal',
                    status: 'pending',
                    dest: userData.upiId || userData.cryptoAddr,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Withdrawal Requested!");
                closeModals();
            } catch (e) { alert(e.message); }
        }

        // USER PROFILE ACTIONS
        async function saveUserPayment() {
            const upi = document.getElementById('user-upi-id').value;
            const cry = document.getElementById('user-crypto-addr').value;
            await db.collection('users').doc(currentUser.uid).update({ upiId: upi, cryptoAddr: cry });
            alert("Payment Details Saved!");
        }

        async function uploadPFP(input) {
            const file = input.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', cloudinaryConfig.uploadPreset);

            try {
                const res = await fetch(cloudinaryConfig.uploadUrl, { method: 'POST', body: formData });
                const data = await res.json();
                await db.collection('users').doc(currentUser.uid).update({ pfp: data.secure_url });
                alert("Profile Picture Updated!");
            } catch (e) { alert("Upload Failed!"); }
        }

        // ADMIN ACTIONS
        function checkAdmin() {
            const pass = document.getElementById('admin-pass').value;
            if (pass === 'admin123') { // Simple pass for demo, should be more secure in real production
                document.getElementById('admin-login-lock').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadAdminData();
            } else {
                alert("Wrong Password!");
            }
        }

        function loadAdminData() {
            // Load Pending TX
            db.collection('transactions').where('status', '==', 'pending').onSnapshot(snap => {
                const body = document.getElementById('admin-tx-body');
                body.innerHTML = '';
                snap.forEach(doc => {
                    const tx = doc.data();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${tx.userName}</td>
                        <td>${tx.type.toUpperCase()}</td>
                        <td>₹${tx.amount}</td>
                        <td>${tx.hash || tx.dest || 'N/A'}</td>
                        <td>
                            <button onclick="approveTx('${doc.id}')" style="background: var(--primary); color: #000; padding: 5px; border-radius: 4px;">Approve</button>
                            <button onclick="rejectTx('${doc.id}')" style="background: var(--danger); color: #fff; padding: 5px; border-radius: 4px;">Reject</button>
                        </td>
                    `;
                    body.appendChild(tr);
                });
            });

            // Fill Settings
            document.getElementById('set-site-name').value = adminSettings.siteName || '';
            document.getElementById('set-admin-upi').value = adminSettings.adminUpi || '';
            document.getElementById('set-admin-btc').value = adminSettings.adminBtc || '';
            document.getElementById('set-admin-eth').value = adminSettings.adminEth || '';
            document.getElementById('set-min-dep').value = adminSettings.minDep || 500;
            document.getElementById('set-ref-bonus').value = adminSettings.refBonus || 0;
            document.getElementById('set-ref-perc').value = adminSettings.refPerc || 0;
            
            // Support numbers admin list
            const adminSupList = document.getElementById('admin-support-list');
            adminSupList.innerHTML = '';
            (adminSettings.supportNumbers || []).forEach((num, i) => {
                adminSupList.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>${num}</span><button onclick="removeSup(${i})" style="color:red;">X</button></div>`;
            });
        }

        async function approveTx(id) {
            const doc = await db.collection('transactions').doc(id).get();
            const tx = doc.data();
            const userRef = db.collection('users').doc(tx.uid);

            if (tx.type === 'deposit') {
                await userRef.update({ 
                    balance: firebase.firestore.FieldValue.increment(tx.amount),
                    totalInvested: firebase.firestore.FieldValue.increment(tx.amount)
                });
            } else {
                await userRef.update({ 
                    balance: firebase.firestore.FieldValue.increment(-tx.amount)
                });
            }

            await db.collection('transactions').doc(id).update({ status: 'approved' });
            alert("Transaction Approved!");
        }

        async function rejectTx(id) {
            await db.collection('transactions').doc(id).update({ status: 'rejected' });
            alert("Transaction Rejected!");
        }

        async function createNewItem() {
            const type = document.getElementById('new-item-type').value;
            const title = document.getElementById('new-item-title').value;
            const min = document.getElementById('new-item-min').value;
            const roi = document.getElementById('new-item-roi').value;
            const days = document.getElementById('new-item-days').value;
            const desc = document.getElementById('new-item-desc').value;
            const imgFile = document.getElementById('new-item-img').files[0];

            let imgUrl = '';
            if (imgFile) {
                const formData = new FormData();
                formData.append('file', imgFile);
                formData.append('upload_preset', cloudinaryConfig.uploadPreset);
                const res = await fetch(cloudinaryConfig.uploadUrl, { method: 'POST', body: formData });
                const data = await res.json();
                imgUrl = data.secure_url;
            }

            await db.collection('content').add({
                type, title, min: parseFloat(min) || 0, roi: parseFloat(roi) || 0, days: parseInt(days) || 0, desc, image: imgUrl, createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("Content Launched!");
        }

        async function saveGeneralSettings() {
            const siteName = document.getElementById('set-site-name').value;
            const primaryColor = document.getElementById('set-primary-color').value;
            const secondaryColor = document.getElementById('set-secondary-color').value;
            await db.collection('admin_settings').doc('config').set({ siteName, primaryColor, secondaryColor }, { merge: true });
            alert("General Settings Updated!");
        }

        async function savePaymentSettings() {
            const adminUpi = document.getElementById('set-admin-upi').value;
            const adminBtc = document.getElementById('set-admin-btc').value;
            const adminEth = document.getElementById('set-admin-eth').value;
            const minDep = parseFloat(document.getElementById('set-min-dep').value);
            const refBonus = parseFloat(document.getElementById('set-ref-bonus').value);
            const refPerc = parseFloat(document.getElementById('set-ref-perc').value);
            await db.collection('admin_settings').doc('config').set({ adminUpi, adminBtc, adminEth, minDep, refBonus, refPerc }, { merge: true });
            alert("Payment Settings Updated!");
        }

        async function addSupportNum() {
            const num = document.getElementById('new-support-num').value;
            const nums = adminSettings.supportNumbers || [];
            nums.push(num);
            await db.collection('admin_settings').doc('config').set({ supportNumbers: nums }, { merge: true });
            document.getElementById('new-support-num').value = '';
            alert("Support Number Added!");
        }

        async function removeSup(idx) {
            const nums = adminSettings.supportNumbers || [];
            nums.splice(idx, 1);
            await db.collection('admin_settings').doc('config').set({ supportNumbers: nums }, { merge: true });
        }

        // REFERRAL LOGIC
        function copyRef() {
            const code = document.getElementById('my-ref-code');
            code.select();
            document.execCommand('copy');
            alert("Code Copied!");
        }

        function shareRef() {
            const link = window.location.origin + '?ref=' + userData.referralCode;
            const msg = `Join ETF Investment Platform and start professional trading! Use my link: ${link}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
        }

    </script>
</body>
</html>
