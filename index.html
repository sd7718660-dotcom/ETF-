<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETF Investment | Elite Institutional Trading Platform</title>
    
    <!-- SEO & PWA META -->
    <meta name="description" content="Access institutional-grade ETF and Crypto investment portfolios. Secure, fast, and high-yield.">
    <meta name="theme-color" content="#050505">
    
    <!-- EXTERNAL LIBRARIES (CDN) -->
    <!-- Firebase Legacy SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <!-- UI/UX Enhancement Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- TAILWIND CUSTOM CONFIG -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#00ff88',
                        secondary: '#ffd700',
                        bgDeep: '#050505',
                        surface: '#121212',
                        glass: 'rgba(255, 255, 255, 0.03)',
                        danger: '#ff4444',
                        warning: '#ffaa00',
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <!-- CUSTOM CSS FOR ULTRA-PREMIUM UI + MOBILE OPTIMIZATIONS -->
    <style>
        :root {
            --primary: #00ff88;
            --secondary: #ffd700;
            --bg-deep: #050505;
            --surface: #121212;
            --trans: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        body {
            background-color: var(--bg-deep);
            color: #ffffff;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            font-size: 15px; /* base font better for mobile */
        }

        /* Professional Scrollbar */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* Glassmorphism & Effects */
        .glass-card {
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .neo-glow { box-shadow: 0 0 20px rgba(0, 255, 136, 0.15); }
        .gold-glow { box-shadow: 0 0 20px rgba(255, 215, 0, 0.15); }

        /* View Animations */
        .page-view {
            display: none;
            animation: viewEnter 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .page-view.active { display: block; }

        @keyframes viewEnter {
            from { opacity: 0; transform: translateY(40px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Navigation Hover States */
        .nav-link {
            transition: var(--trans);
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px; left: 50%;
            width: 0; height: 2px;
            background: var(--primary);
            transition: var(--trans);
            transform: translateX(-50%);
        }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }

        /* Mobile Bottom Nav Active + Touch Friendly */
        .mobile-nav-btn {
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            padding: 8px 0;
            min-height: 52px;
            font-size: 10px;
        }
        .mobile-nav-btn.active {
            color: var(--primary) !important;
            transform: scale(1.08);
        }
        .mobile-nav-btn i {
            font-size: 1.35rem;
        }

        /* Market Table Optimization */
        .market-row {
            transition: var(--trans);
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        .market-row:hover {
            background: rgba(255,255,255,0.02);
            transform: translateX(10px);
        }

        /* Loader Animation */
        .loader-ring {
            width: 100px; height: 100px;
            border: 3px solid #111;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Mobile Bottom Nav Bar */
        @media (max-width: 1024px) {
            .desktop-sidebar { display: none !important; }
            .main-content { 
                margin-left: 0 !important; 
                padding: 1rem !important; 
                padding-bottom: 110px !important; 
            }
            .glass-card { border-radius: 24px; }
            h1 { font-size: 2.25rem !important; line-height: 1.1; }
            h2 { font-size: 1.75rem !important; }
            .text-5xl { font-size: 2.5rem !important; }
            .text-6xl { font-size: 3rem !important; }
            .p-12 { padding: 1.5rem !important; }
            .p-10 { padding: 1.25rem !important; }
        }

        /* Profile Image Upload Overlay */
        .pfp-overlay {
            opacity: 0;
            transition: var(--trans);
        }
        .pfp-container:hover .pfp-overlay { opacity: 1; }

        /* Custom Checkbox/Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px; height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #222;
            transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* Wallet Tab Active */
        .wallet-tab.active {
            background: var(--primary) !important;
            color: black !important;
            border-color: var(--primary) !important;
        }
    </style>
</head>
<body class="font-sans">

    <!-- GLOBAL SYSTEM LOADER -->
    <div id="master-loader" class="fixed inset-0 z-[10000] bg-bgDeep flex flex-col items-center justify-center">
        <div class="loader-ring mb-8"></div>
        <h2 class="text-primary font-black tracking-[8px] text-lg">ETF ELITE TERMINAL</h2>
        <p class="text-gray-500 text-[11px] mt-4 uppercase tracking-[5px]">Initializing Institutional Core...</p>
    </div>

    <!-- AUTHENTICATION PORTAL -->
    <div id="auth-view" class="fixed inset-0 z-[9000] bg-bgDeep flex items-center justify-center p-6 overflow-y-auto hidden">
        <div class="glass-card w-full max-w-lg p-10 rounded-3xl border-primary/20">
            <div class="text-center mb-12">
                <i class="fas fa-shield-halved text-6xl text-primary mb-6 drop-shadow-[0_0_15px_#00ff88]"></i>
                <h1 class="text-4xl font-black tracking-tighter">ETF <span class="text-primary">ELITE</span></h1>
                <p class="text-gray-400 text-sm mt-3 font-medium">Access Institutional Grade Investment Pools</p>
            </div>

            <!-- Login Pane -->
            <div id="login-pane" class="space-y-6">
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 block">Terminal Identity (Phone)</label>
                    <input type="text" id="login-phone" class="w-full bg-black/50 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-medium" placeholder="+91 00000 00000">
                </div>
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 block">Access Key</label>
                    <input type="password" id="login-pass" class="w-full bg-black/50 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-medium" placeholder="••••••••">
                </div>
                <button onclick="handleAuth('login')" class="w-full bg-primary text-black font-black py-5 rounded-2xl neo-glow hover:scale-[1.02] active:scale-[0.98] transition-all text-lg">INITIALIZE SESSION</button>
                <p class="text-center text-gray-500 text-sm mt-8">New Operator? <span onclick="toggleAuth('reg')" class="text-primary font-bold cursor-pointer hover:underline ml-2">Create Identity</span></p>
            </div>

            <!-- Register Pane -->
            <div id="reg-pane" class="hidden space-y-6">
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 block">Full Operator Name</label>
                    <input type="text" id="reg-name" class="w-full bg-black/50 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-medium" placeholder="John Doe">
                </div>
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 block">Terminal Identity (Phone)</label>
                    <input type="text" id="reg-phone" class="w-full bg-black/50 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-medium" placeholder="+91 00000 00000">
                </div>
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 block">Security Key</label>
                    <input type="password" id="reg-pass" class="w-full bg-black/50 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-medium" placeholder="Create Password">
                </div>
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-widest mb-3 block">Verify Security Key</label>
                    <input type="password" id="reg-confirm" class="w-full bg-black/50 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-medium" placeholder="Confirm Password">
                </div>
                <button onclick="handleAuth('register')" class="w-full bg-primary text-black font-black py-5 rounded-2xl neo-glow hover:scale-[1.02] active:scale-[0.98] transition-all text-lg">CREATE IDENTITY</button>
                <p class="text-center text-gray-500 text-sm mt-8">Already Identified? <span onclick="toggleAuth('login')" class="text-primary font-bold cursor-pointer hover:underline ml-2">Login to Terminal</span></p>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION SHELL -->
    <div id="app-shell" class="flex min-h-screen hidden">
        
        <!-- DESKTOP SIDEBAR -->
        <aside class="desktop-sidebar w-80 h-screen fixed left-0 top-0 bg-surface border-r border-white/5 p-8 flex flex-col z-50">
            <div class="flex items-center gap-5 mb-16 px-2">
                <i class="fas fa-microchip text-4xl text-primary drop-shadow-[0_0_10px_#00ff88]"></i>
                <h3 class="text-2xl font-black tracking-tighter">ETF <span class="text-primary">ELITE</span></h3>
            </div>

            <nav class="flex-grow space-y-3">
                <div class="text-[11px] font-bold text-gray-600 uppercase tracking-[4px] mb-6 px-4">Terminal Control</div>
                <button onclick="switchPage('home', this)" class="nav-link active w-full flex items-center gap-5 px-5 py-4 rounded-2xl text-gray-400 hover:text-white hover:bg-white/5 font-bold transition-all">
                    <i class="fas fa-house-chimney text-xl w-8"></i><span>Dashboard</span>
                </button>
                <button onclick="switchPage('market', this)" class="nav-link w-full flex items-center gap-5 px-5 py-4 rounded-2xl text-gray-400 hover:text-white hover:bg-white/5 font-bold transition-all">
                    <i class="fas fa-chart-line text-xl w-8"></i><span>Global Market</span>
                </button>
                <button onclick="switchPage('invest', this)" class="nav-link w-full flex items-center gap-5 px-5 py-4 rounded-2xl text-gray-400 hover:text-white hover:bg-white/5 font-bold transition-all">
                    <i class="fas fa-briefcase text-xl w-8"></i><span>Opportunities</span>
                </button>
                
                <div class="text-[11px] font-bold text-gray-600 uppercase tracking-[4px] mt-12 mb-6 px-4">Assets & Network</div>
                <button onclick="switchPage('wallet', this)" class="nav-link w-full flex items-center gap-5 px-5 py-4 rounded-2xl text-gray-400 hover:text-white hover:bg-white/5 font-bold transition-all">
                    <i class="fas fa-wallet text-xl w-8"></i><span>My Assets</span>
                </button>
                <button onclick="switchPage('referral', this)" class="nav-link w-full flex items-center gap-5 px-5 py-4 rounded-2xl text-gray-400 hover:text-white hover:bg-white/5 font-bold transition-all">
                    <i class="fas fa-users-gear text-xl w-8"></i><span>Elite Network</span>
                </button>

                <div class="text-[11px] font-bold text-gray-600 uppercase tracking-[4px] mt-12 mb-6 px-4">Assistance</div>
                <button onclick="switchPage('support', this)" class="nav-link w-full flex items-center gap-5 px-5 py-4 rounded-2xl text-gray-400 hover:text-white hover:bg-white/5 font-bold transition-all">
                    <i class="fas fa-headset text-xl w-8"></i><span>24/7 Support</span>
                </button>
            </nav>

            <div class="mt-auto pt-8 border-t border-white/5">
                <div onclick="switchPage('profile')" class="flex items-center gap-5 p-4 rounded-2xl bg-black/40 hover:bg-black/60 cursor-pointer transition-all border border-white/5">
                    <img id="user-pfp-side" src="https://via.placeholder.com/100" class="w-12 h-12 rounded-full border-2 border-primary object-cover">
                    <div class="overflow-hidden">
                        <h4 id="user-name-side" class="text-sm font-black truncate">Operator</h4>
                        <p class="text-[10px] text-gray-500 uppercase font-black tracking-widest">Elite Trader</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MOBILE BOTTOM NAVIGATION -->
        <div class="mobile-nav lg:hidden fixed bottom-0 left-0 w-full bg-[rgba(10,10,10,0.95)] backdrop-blur-2xl border-t border-white/10 flex justify-around py-3 z-[9999]">
            <button onclick="switchPage('home')" class="mobile-nav-btn flex flex-col items-center gap-1 text-gray-400 active" data-page="home">
                <i class="fas fa-house-chimney"></i><span class="text-[9px] font-bold uppercase tracking-widest">Home</span>
            </button>
            <button onclick="switchPage('market')" class="mobile-nav-btn flex flex-col items-center gap-1 text-gray-400" data-page="market">
                <i class="fas fa-chart-line"></i><span class="text-[9px] font-bold uppercase tracking-widest">Market</span>
            </button>
            <button onclick="switchPage('invest')" class="mobile-nav-btn flex flex-col items-center gap-1 text-gray-400" data-page="invest">
                <i class="fas fa-briefcase"></i><span class="text-[9px] font-bold uppercase tracking-widest">Invest</span>
            </button>
            <button onclick="switchPage('wallet')" class="mobile-nav-btn flex flex-col items-center gap-1 text-gray-400" data-page="wallet">
                <i class="fas fa-wallet"></i><span class="text-[9px] font-bold uppercase tracking-widest">Wallet</span>
            </button>
            <button onclick="switchPage('profile')" class="mobile-nav-btn flex flex-col items-center gap-1 text-gray-400" data-page="profile">
                <i class="fas fa-user-circle"></i><span class="text-[9px] font-bold uppercase tracking-widest">Profile</span>
            </button>
        </div>

        <!-- MAIN CONTENT VIEWPORT -->
        <main class="main-content flex-grow lg:ml-80 p-6 lg:p-12">
            
            <!-- TOP GLOBAL HEADER -->
            <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-8 mb-16">
                <div>
                    <h1 class="text-4xl font-black tracking-tight mb-3">Welcome Back, <span id="user-greeting" class="text-primary">Operator</span></h1>
                    <div class="flex items-center gap-4">
                        <span class="flex items-center gap-2 text-primary font-bold text-sm">
                            <span class="w-2 h-2 bg-primary rounded-full animate-pulse"></span> Live Terminal Active
                        </span>
                        <span class="text-gray-600 font-bold text-sm">•</span>
                        <span class="text-gray-500 font-bold text-sm" id="global-timer">00:00:00 UTC</span>
                    </div>
                </div>
                <div class="flex items-center gap-5">
                    <div class="relative group">
                        <div class="absolute -inset-1 bg-gradient-to-r from-primary to-secondary rounded-2xl blur opacity-25 group-hover:opacity-60 transition duration-1000"></div>
                        <button onclick="openModal('deposit')" class="relative bg-surface px-8 py-4 rounded-2xl flex items-center gap-4 font-black border border-white/5 hover:border-primary/30 transition-all">
                            <i class="fas fa-circle-plus text-primary text-xl"></i> Quick Deposit
                        </button>
                    </div>
                    <button onclick="handleLogout()" class="bg-danger/10 text-danger p-5 rounded-2xl hover:bg-danger hover:text-white transition-all border border-danger/10">
                        <i class="fas fa-power-off text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- PAGE VIEWS ENGINE -->

            <!-- VIEW: DASHBOARD HOME -->
            <section id="view-home" class="page-view active">
                <!-- HERO BANNER -->
                <div class="glass-card p-8 lg:p-12 rounded-[40px] mb-12 border-primary/10 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-12 opacity-5 group-hover:opacity-20 transition-all duration-1000">
                        <i class="fas fa-rocket text-[180px] lg:text-[200px] text-primary rotate-12"></i>
                    </div>
                    <div class="relative z-10 max-w-2xl">
                        <h2 class="text-4xl lg:text-5xl font-black tracking-tighter mb-6 leading-tight">Institutional <span class="text-primary">ETF Portfolios</span> are now Live.</h2>
                        <p class="text-gray-400 text-base lg:text-lg font-medium leading-relaxed mb-10">Access high-yield managed assets with real-time liquidity bridge. Diversify your capital across 1000+ crypto assets and curated ETF baskets.</p>
                        <div class="flex flex-wrap gap-5">
                            <button onclick="switchPage('invest')" class="bg-primary text-black font-black px-10 py-5 rounded-2xl neo-glow text-lg">EXPLORE PLANS</button>
                            <button onclick="switchPage('market')" class="bg-white/5 border border-white/10 px-10 py-5 rounded-2xl font-black text-lg hover:bg-white/10 transition-all">LIVE MARKET</button>
                        </div>
                    </div>
                </div>

                <!-- KEY METRICS -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
                    <div class="glass-card p-8 lg:p-10 rounded-3xl relative overflow-hidden group border-primary/5">
                        <div class="absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-15 transition-all">
                            <i class="fas fa-vault text-7xl lg:text-8xl text-primary"></i>
                        </div>
                        <p class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-6">Portfolio Net Value</p>
                        <h2 id="bal-total" class="text-4xl lg:text-5xl font-black font-mono tracking-tighter mb-6">₹0.00</h2>
                        <div class="flex items-center gap-3 text-primary font-bold text-sm">
                            <i class="fas fa-arrow-trend-up"></i> +14.2% Growth This Month
                        </div>
                    </div>
                    <div class="glass-card p-8 lg:p-10 rounded-3xl relative overflow-hidden group border-secondary/5">
                        <div class="absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-15 transition-all">
                            <i class="fas fa-chart-pie text-7xl lg:text-8xl text-secondary"></i>
                        </div>
                        <p class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-6">Active Deployments</p>
                        <h2 id="bal-invested" class="text-4xl lg:text-5xl font-black font-mono tracking-tighter mb-6 text-secondary">₹0.00</h2>
                        <div class="flex items-center gap-3 text-gray-500 font-bold text-sm">
                            <i class="fas fa-shield-check"></i> 5 Institutional Plans Active
                        </div>
                    </div>
                    <div class="glass-card p-8 lg:p-10 rounded-3xl relative overflow-hidden group border-primary/5">
                        <div class="absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-15 transition-all">
                            <i class="fas fa-sack-dollar text-7xl lg:text-8xl text-primary"></i>
                        </div>
                        <p class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-6">Realized Profit</p>
                        <h2 id="bal-profit" class="text-4xl lg:text-5xl font-black font-mono tracking-tighter mb-6">₹0.00</h2>
                        <div class="flex items-center gap-3 text-primary font-bold text-sm">
                            <i class="fas fa-circle-check"></i> Verified Real-time ROI
                        </div>
                    </div>
                </div>

                <!-- FEATURED OPPORTUNITIES -->
                <div class="flex items-center justify-between mb-10">
                    <h2 class="text-2xl lg:text-3xl font-black tracking-tight"><i class="fas fa-fire text-secondary mr-4"></i>Elite <span class="text-primary">Opportunities</span></h2>
                    <button onclick="switchPage('invest')" class="text-primary font-black text-sm hover:underline flex items-center gap-2">View All Assets <i class="fas fa-arrow-right"></i></button>
                </div>
                <div id="featured-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10 mb-20">
                    <!-- Dynamic Featured Cards -->
                </div>

                <!-- RECENT TERMINAL LOGS -->
                <div class="glass-card p-8 lg:p-10 rounded-[32px]">
                    <h3 class="text-xl lg:text-2xl font-black mb-10 flex items-center gap-4">
                        <i class="fas fa-list-ul text-primary"></i> Terminal Activity Logs
                        <span class="text-gray-600 text-sm font-bold ml-auto">Latest 10 Sessions</span>
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="text-[11px] text-gray-500 uppercase tracking-[4px] border-b border-white/5">
                                <tr>
                                    <th class="pb-6">Timestamp</th>
                                    <th class="pb-6">Operation Type</th>
                                    <th class="pb-6">Asset Value</th>
                                    <th class="pb-6 text-right">Settlement Status</th>
                                </tr>
                            </thead>
                            <tbody id="home-tx-list" class="text-sm font-medium">
                                <!-- Dynamic Activity Rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- VIEW: LIVE MARKET TERMINAL -->
            <section id="view-market" class="page-view">
                <div class="glass-card p-8 lg:p-12 rounded-[40px] mb-12 border-primary/10 flex flex-col lg:flex-row items-center justify-between gap-12 relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent"></div>
                    <div class="relative z-10 max-w-3xl">
                        <h1 class="text-5xl lg:text-6xl font-black tracking-tighter mb-6">Global <span class="text-primary">Crypto Bridge</span></h1>
                        <p class="text-gray-400 text-lg lg:text-xl font-medium leading-relaxed">Institutional grade data feeds for over 1,000+ crypto assets. Real-time liquidity monitoring and 0.01s trade execution latency.</p>
                    </div>
                    <div class="relative z-10 text-center lg:text-right">
                        <div class="text-primary font-black text-3xl lg:text-4xl font-mono mb-2" id="market-price-ticker">$0.00</div>
                        <p class="text-gray-500 font-bold uppercase tracking-widest text-xs">Global Market Cap (BTC/USD)</p>
                    </div>
                </div>

                <div class="flex flex-col lg:flex-row gap-10">
                    <!-- Main Market List -->
                    <div class="flex-grow">
                        <div class="glass-card rounded-[32px] overflow-hidden">
                            <div class="p-6 lg:p-8 border-b border-white/5 flex flex-col md:flex-row md:items-center justify-between gap-6">
                                <h3 class="font-black text-xl lg:text-2xl">Asset Liquidity Pool</h3>
                                <div class="flex items-center gap-5">
                                    <div class="relative flex-1 md:flex-none">
                                        <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-gray-500"></i>
                                        <input type="text" id="market-search" placeholder="Search 1000+ Assets..." class="bg-black/40 border border-white/10 rounded-2xl pl-14 pr-6 py-4 outline-none focus:border-primary text-sm w-full md:w-80 transition-all font-bold">
                                    </div>
                                    <button class="bg-surface p-4 rounded-2xl border border-white/10 hover:text-primary transition-all"><i class="fas fa-sliders text-lg"></i></button>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead class="text-[11px] text-gray-500 uppercase tracking-[4px] bg-black/20">
                                        <tr>
                                            <th class="p-6 lg:p-8">Institutional Asset</th>
                                            <th class="p-6 lg:p-8">Market Price</th>
                                            <th class="p-6 lg:p-8">24h Volatility</th>
                                            <th class="p-6 lg:p-8">Capitalization</th>
                                            <th class="p-6 lg:p-8 text-right">Execution</th>
                                        </tr>
                                    </thead>
                                    <tbody id="market-list-body">
                                        <!-- Dynamic 1000+ Coins Loaded Here -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="market-load-more" class="p-8 lg:p-12 text-center border-t border-white/5">
                                <button onclick="loadMoreCoins()" class="bg-white/5 px-10 py-5 rounded-2xl font-black text-primary hover:bg-primary hover:text-black transition-all flex items-center gap-3 mx-auto">
                                    LOAD INSTITUTIONAL FEED <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Market Sidebar Insights -->
                    <div class="w-full lg:w-[400px] space-y-10">
                        <div class="glass-card p-8 lg:p-10 rounded-[32px]">
                            <h3 class="font-black text-xl mb-8 border-b border-white/5 pb-5 flex items-center gap-3">
                                <i class="fas fa-newspaper text-primary"></i> Elite Intelligence
                            </h3>
                            <div id="market-news" class="space-y-8">
                                <!-- Dynamic Intelligence Feeds -->
                            </div>
                        </div>
                        <div class="glass-card p-8 lg:p-10 rounded-[32px] bg-gradient-to-br from-surface to-black border-secondary/20">
                            <h3 class="font-black text-xl mb-8 text-secondary flex items-center gap-3">
                                <i class="fas fa-fire"></i> Hot Assets (24h)
                            </h3>
                            <div id="market-trending" class="space-y-5">
                                <!-- Dynamic Trending Assets -->
                            </div>
                        </div>
                        <div class="glass-card p-8 lg:p-10 rounded-[32px]">
                            <h3 class="font-black text-xl mb-8 flex items-center gap-3">
                                <i class="fas fa-chart-area text-primary"></i> Market Sentiment
                            </h3>
                            <div class="text-center py-6">
                                <div class="text-5xl lg:text-6xl font-black text-primary mb-4" id="sentiment-value">78</div>
                                <p class="text-gray-400 font-black uppercase tracking-[5px] text-xs">Extreme Greed</p>
                                <div class="w-full h-3 bg-black/40 rounded-full mt-8 overflow-hidden">
                                    <div class="h-full bg-primary" style="width: 78%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: INVESTMENT VAULT -->
            <section id="view-invest" class="page-view">
                <div class="mb-16">
                    <h1 class="text-4xl lg:text-5xl font-black tracking-tight mb-5">Elite <span class="text-primary">Investment Vault</span></h1>
                    <p class="text-gray-500 text-lg font-medium max-w-3xl leading-relaxed">Curated institutional-grade portfolios designed for high-performance ROI. Diversify your capital across global high-growth sectors with SQL-backed security.</p>
                </div>

                <div id="invest-plans-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-12">
                    <!-- Dynamic Investment Plans -->
                </div>
            </section>

            <!-- VIEW: ASSET MANAGEMENT (WALLET) -->
            <section id="view-wallet" class="page-view">
                <div class="glass-card p-8 lg:p-12 rounded-[40px] mb-12 flex flex-col lg:flex-row items-center justify-between gap-12 border-primary/10">
                    <div class="flex items-center gap-10">
                        <div class="w-20 h-20 lg:w-24 lg:h-24 bg-primary/10 rounded-3xl flex items-center justify-center border border-primary/20">
                            <i class="fas fa-wallet text-4xl lg:text-5xl text-primary"></i>
                        </div>
                        <div>
                            <p class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-2">Total Managed Liquidity</p>
                            <h1 id="wallet-total-val" class="text-5xl lg:text-6xl font-black font-mono tracking-tighter">₹0.00</h1>
                        </div>
                    </div>
                    <div class="flex items-center gap-5 w-full lg:w-auto">
                        <button onclick="openModal('deposit')" class="flex-grow bg-primary text-black font-black px-12 py-6 rounded-2xl neo-glow text-lg">DEPOSIT</button>
                        <button onclick="openModal('withdraw')" class="flex-grow bg-danger/10 text-danger border border-danger/20 font-black px-12 py-6 rounded-2xl hover:bg-danger hover:text-white transition-all text-lg">WITHDRAW</button>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4 mb-10 overflow-x-auto pb-2">
                    <button onclick="switchWalletTab('tx', this)" class="wallet-tab active px-8 py-4 rounded-2xl bg-surface border border-white/5 font-black text-gray-400 hover:text-white transition-all whitespace-nowrap">Settlement History</button>
                    <button onclick="switchWalletTab('holdings', this)" class="wallet-tab px-8 py-4 rounded-2xl bg-surface border border-white/5 font-black text-gray-400 hover:text-white transition-all whitespace-nowrap">Asset Holdings</button>
                    <button onclick="switchWalletTab('etf', this)" class="wallet-tab px-8 py-4 rounded-2xl bg-surface border border-white/5 font-black text-gray-400 hover:text-white transition-all whitespace-nowrap">ETF Portfolios</button>
                </div>

                <div id="wallet-pane-tx" class="glass-card rounded-[32px] overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="text-[11px] text-gray-500 uppercase tracking-[4px] bg-black/20">
                            <tr>
                                <th class="p-6 lg:p-8">Execution Date</th>
                                <th class="p-6 lg:p-8">Operation</th>
                                <th class="p-6 lg:p-8">Method</th>
                                <th class="p-6 lg:p-8">Asset Value</th>
                                <th class="p-6 lg:p-8 text-right">Settlement Status</th>
                            </tr>
                        </thead>
                        <tbody id="wallet-tx-body" class="font-medium">
                            <!-- Dynamic Transactions -->
                        </tbody>
                    </table>
                </div>

                <div id="wallet-pane-holdings" class="hidden grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Dynamic Asset Holdings -->
                </div>
            </section>

            <!-- VIEW: OPERATOR PROFILE -->
            <section id="view-profile" class="page-view">
                <div class="max-w-5xl mx-auto">
                    <div class="glass-card p-10 lg:p-16 rounded-[48px] text-center mb-12 relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-b from-primary/10 to-transparent"></div>
                        <div class="relative z-10">
                            <div class="w-36 h-36 lg:w-44 lg:h-44 mx-auto relative mb-8 group pfp-container">
                                <img id="prof-pfp" src="https://via.placeholder.com/200" class="w-full h-full rounded-full border-4 border-primary object-cover shadow-2xl transition-all group-hover:brightness-50">
                                <label for="pfp-upload" class="absolute inset-0 flex items-center justify-center cursor-pointer pfp-overlay rounded-full">
                                    <i class="fas fa-camera text-4xl text-white"></i>
                                </label>
                                <input type="file" id="pfp-upload" class="hidden" accept="image/*" onchange="handlePfpUpload(this)">
                            </div>
                            <h1 id="prof-name" class="text-4xl lg:text-5xl font-black mb-3 tracking-tight">Operator Name</h1>
                            <p id="prof-phone" class="text-gray-500 font-mono text-xl mb-8 tracking-widest">+91 00000 00000</p>
                            <div class="flex items-center justify-center gap-5">
                                <span class="bg-secondary/10 text-secondary border border-secondary/20 px-6 py-3 rounded-full text-[11px] font-black tracking-[4px] uppercase">Elite Operator</span>
                                <span class="bg-primary/10 text-primary border border-primary/20 px-6 py-3 rounded-full text-[11px] font-black tracking-[4px] uppercase">Verified ID</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                        <!-- Identity Settings -->
                        <div class="glass-card p-8 lg:p-10 rounded-[32px]">
                            <h3 class="text-2xl font-black mb-10 border-b border-white/5 pb-5 flex items-center gap-4">
                                <i class="fas fa-user-shield text-primary"></i> Terminal Identity
                            </h3>
                            <div class="space-y-8">
                                <div>
                                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-3 block">Settlement UPI ID</label>
                                    <input type="text" id="prof-upi" class="w-full bg-black/40 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-bold" placeholder="operator@upi">
                                </div>
                                <div>
                                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-3 block">Crypto Bridge Address (BTC/ETH)</label>
                                    <input type="text" id="prof-crypto" class="w-full bg-black/40 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none transition-all font-bold" placeholder="0x... or bc1...">
                                </div>
                                <button onclick="saveProfileSettings()" class="w-full bg-primary text-black font-black py-5 rounded-2xl neo-glow text-lg">UPDATE TERMINAL IDENTITY</button>
                            </div>
                        </div>

                        <!-- Security Protocol -->
                        <div class="glass-card p-8 lg:p-10 rounded-[32px]">
                            <h3 class="text-2xl font-black mb-10 border-b border-white/5 pb-5 flex items-center gap-4">
                                <i class="fas fa-lock text-primary"></i> Security Protocol
                            </h3>
                            <div class="space-y-8">
                                <div class="flex items-center justify-between p-6 bg-black/40 rounded-2xl border border-white/5">
                                    <div>
                                        <h4 class="font-black text-lg">Multi-Factor Auth</h4>
                                        <p class="text-[11px] text-gray-500 font-bold uppercase tracking-widest mt-1">Institutional security for withdrawals</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between p-6 bg-black/40 rounded-2xl border border-white/5">
                                    <div>
                                        <h4 class="font-black text-lg">Real-time Alerts</h4>
                                        <p class="text-[11px] text-gray-500 font-bold uppercase tracking-widest mt-1">Instant SMS & Terminal notifications</p>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="p-8 bg-danger/5 border border-danger/10 rounded-2xl">
                                    <p class="text-[11px] text-danger font-black uppercase tracking-[4px] mb-4">Emergency Protocol</p>
                                    <button class="text-danger font-black text-sm hover:underline flex items-center gap-3">
                                        <i class="fas fa-triangle-exclamation"></i> Freeze All Terminal Assets
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: ELITE NETWORK (REFERRAL) -->
            <section id="view-referral" class="page-view">
                <div class="glass-card p-10 lg:p-16 rounded-[48px] mb-12 border-secondary/10 bg-gradient-to-br from-surface to-black relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-16 opacity-5 group-hover:opacity-15 transition-all duration-1000">
                        <i class="fas fa-users-viewfinder text-[180px] lg:text-[200px] text-secondary"></i>
                    </div>
                    <div class="relative z-10 max-w-3xl">
                        <h1 class="text-5xl lg:text-6xl font-black tracking-tighter mb-6 text-secondary">Elite <span class="text-white">Network</span></h1>
                        <p class="text-gray-400 text-xl font-medium leading-relaxed mb-10">Expand the SQL Elite network and earn institutional commissions on every successful referral. Grow your network, grow your wealth.</p>
                        <div class="flex items-center gap-5">
                            <input type="text" id="ref-link-input" readonly class="bg-black/40 border border-white/10 rounded-2xl px-8 py-5 focus:border-secondary outline-none text-secondary font-mono font-bold text-lg flex-grow tracking-wider">
                            <button onclick="copyRefLink()" class="bg-secondary text-black font-black px-10 py-5 rounded-2xl gold-glow text-lg">COPY LINK</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                    <div class="glass-card p-10 rounded-3xl border-secondary/5">
                        <p class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4">Total Network Operators</p>
                        <h2 id="ref-count" class="text-5xl font-black font-mono tracking-tighter text-secondary">0</h2>
                    </div>
                    <div class="glass-card p-10 rounded-3xl border-secondary/5">
                        <p class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4">Network Commission</p>
                        <h2 id="ref-earned" class="text-5xl font-black font-mono tracking-tighter text-secondary">₹0.00</h2>
                    </div>
                    <div class="glass-card p-10 rounded-3xl border-secondary/5">
                        <p class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4">Current Network Rank</p>
                        <h2 class="text-5xl font-black font-mono tracking-tighter text-secondary">SILVER</h2>
                    </div>
                </div>

                <button onclick="shareRefWA()" class="w-full bg-secondary text-black font-black py-6 rounded-3xl gold-glow text-2xl flex items-center justify-center gap-5">
                    <i class="fab fa-whatsapp text-3xl"></i> BROADCAST TO NETWORK
                </button>
            </section>

            <!-- VIEW: ELITE SUPPORT -->
            <section id="view-support" class="page-view">
                <div class="max-w-4xl mx-auto text-center">
                    <div class="w-28 h-28 lg:w-32 lg:h-32 bg-primary/10 rounded-[40px] flex items-center justify-center mx-auto mb-10 border border-primary/20">
                        <i class="fas fa-headset text-5xl lg:text-6xl text-primary"></i>
                    </div>
                    <h1 class="text-5xl lg:text-6xl font-black tracking-tight mb-6">Elite <span class="text-primary">Support</span></h1>
                    <p class="text-gray-400 text-xl font-medium leading-relaxed mb-16 max-w-2xl mx-auto">Direct encrypted lines to institutional support managers. Available 24/7 for Elite terminal operators.</p>
                    
                    <div id="support-line-container" class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-20">
                        <!-- Dynamic Support Lines -->
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="glass-card p-10 rounded-3xl">
                            <i class="fas fa-shield-check text-4xl text-primary mb-6"></i>
                            <h4 class="font-black text-lg mb-4 uppercase tracking-widest">Fund Safety</h4>
                            <p class="text-gray-500 text-sm font-medium">100% Institutional Guarantee on all assets.</p>
                        </div>
                        <div class="glass-card p-10 rounded-3xl">
                            <i class="fas fa-bolt text-4xl text-primary mb-6"></i>
                            <h4 class="font-black text-lg mb-4 uppercase tracking-widest">Fast Settlement</h4>
                            <p class="text-gray-500 text-sm font-medium">Instant bridge execution for all liquidations.</p>
                        </div>
                        <div class="glass-card p-10 rounded-3xl">
                            <i class="fas fa-lock text-4xl text-primary mb-6"></i>
                            <h4 class="font-black text-lg mb-4 uppercase tracking-widest">Privacy First</h4>
                            <p class="text-gray-500 text-sm font-medium">End-to-end encrypted terminal communications.</p>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- MODAL SYSTEM OVERLAYS -->
    
    <!-- Modal: Deposit -->
    <div id="modal-deposit" class="fixed inset-0 z-[1000] bg-black/95 backdrop-blur-2xl flex items-center justify-center p-6 hidden">
        <div class="glass-card w-full max-w-2xl p-12 rounded-[40px] border-primary/20 relative overflow-y-auto max-h-[90vh]">
            <button onclick="closeModal('deposit')" class="absolute top-8 right-8 text-gray-500 hover:text-danger text-3xl transition-all">&times;</button>
            <h2 class="text-4xl font-black mb-3 tracking-tight">Initialize <span class="text-primary">Deposit</span></h2>
            <p class="text-gray-500 text-lg font-medium mb-10">Select settlement method and asset value.</p>
            
            <div class="space-y-10">
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4 block">Deposit Asset Value (₹)</label>
                    <input type="number" id="dep-amt" class="w-full bg-black/40 border border-white/10 rounded-3xl px-8 py-6 focus:border-primary outline-none text-4xl font-mono font-black tracking-tighter" placeholder="Min ₹500">
                    <div class="flex flex-wrap gap-3 mt-6">
                        <button onclick="setDep(1000)" class="flex-grow bg-white/5 py-4 rounded-2xl text-sm font-black hover:bg-primary hover:text-black transition-all">₹1,000</button>
                        <button onclick="setDep(5000)" class="flex-grow bg-white/5 py-4 rounded-2xl text-sm font-black hover:bg-primary hover:text-black transition-all">₹5,000</button>
                        <button onclick="setDep(10000)" class="flex-grow bg-white/5 py-4 rounded-2xl text-sm font-black hover:bg-primary hover:text-black transition-all">₹10,000</button>
                        <button onclick="setDep(50000)" class="flex-grow bg-white/5 py-4 rounded-2xl text-sm font-black hover:bg-primary hover:text-black transition-all">₹50,000</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <button onclick="switchPay('upi')" id="pay-btn-upi" class="pay-tab active p-8 rounded-3xl bg-surface border-2 border-primary/20 text-center group transition-all">
                        <i class="fas fa-mobile-screen text-3xl mb-4 text-primary group-hover:scale-110 transition-all"></i>
                        <p class="text-sm font-black uppercase tracking-widest">UPI Settlement</p>
                    </button>
                    <button onclick="switchPay('crypto')" id="pay-btn-crypto" class="pay-tab p-8 rounded-3xl bg-surface border-2 border-white/5 text-center group transition-all">
                        <i class="fab fa-bitcoin text-3xl mb-4 text-gray-500 group-hover:text-primary transition-all"></i>
                        <p class="text-sm font-black uppercase tracking-widest">Crypto Bridge</p>
                    </button>
                </div>

                <!-- UPI Pane -->
                <div id="pane-upi" class="p-10 bg-black/40 rounded-[32px] border border-dashed border-primary/30 text-center">
                    <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-4">Elite UPI Identity</p>
                    <h3 id="disp-adm-upi" class="text-2xl font-mono font-black text-primary mb-8 tracking-wider">loading...</h3>
                    <div class="w-56 h-56 bg-white mx-auto rounded-3xl flex items-center justify-center text-black font-black mb-8 text-xl">QR SCANNER</div>
                    <a href="#" id="upi-link" class="block w-full bg-primary text-black font-black py-6 rounded-2xl neo-glow text-lg">OPEN UPI TERMINAL</a>
                </div>

                <!-- Crypto Pane -->
                <div id="pane-crypto" class="hidden p-10 bg-black/40 rounded-[32px] border border-dashed border-primary/30 space-y-8">
                    <div>
                        <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-2">BTC Bridge Address</p>
                        <p id="disp-adm-btc" class="text-sm font-mono text-secondary font-bold break-all tracking-wider">loading...</p>
                    </div>
                    <div>
                        <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-2">ETH Bridge Address</p>
                        <p id="disp-adm-eth" class="text-sm font-mono text-secondary font-bold break-all tracking-wider">loading...</p>
                    </div>
                </div>

                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4 block">Settlement Reference (UTR / Hash)</label>
                    <input type="text" id="dep-ref" class="w-full bg-black/40 border border-white/10 rounded-2xl px-8 py-6 focus:border-primary outline-none font-bold" placeholder="Enter Transaction Reference">
                </div>

                <button onclick="submitDeposit()" class="w-full bg-primary text-black font-black py-6 rounded-2xl neo-glow text-xl">SUBMIT SETTLEMENT</button>
            </div>
        </div>
    </div>

    <!-- Modal: Withdraw -->
    <div id="modal-withdraw" class="fixed inset-0 z-[1000] bg-black/95 backdrop-blur-2xl flex items-center justify-center p-6 hidden">
        <div class="glass-card w-full max-w-2xl p-12 rounded-[40px] border-danger/20 relative">
            <button onclick="closeModal('withdraw')" class="absolute top-8 right-8 text-gray-500 hover:text-danger text-3xl transition-all">&times;</button>
            <h2 class="text-4xl font-black mb-3 tracking-tight">Asset <span class="text-danger">Liquidation</span></h2>
            <p class="text-gray-500 text-lg font-medium mb-12">Initialize withdrawal to your verified destination.</p>
            
            <div class="space-y-10">
                <div class="p-10 bg-black/40 rounded-[32px] border border-white/5">
                    <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-3">Withdrawable Balance</p>
                    <h2 id="wd-max" class="text-6xl font-black font-mono tracking-tighter">₹0.00</h2>
                </div>

                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4 block">Liquidation Value (₹)</label>
                    <input type="number" id="wd-amt" class="w-full bg-black/40 border border-white/10 rounded-3xl px-8 py-6 focus:border-danger outline-none text-4xl font-mono font-black tracking-tighter" placeholder="Enter Amount">
                </div>

                <div class="p-8 bg-surface border border-white/5 rounded-[32px]">
                    <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-3">Settlement Identity</p>
                    <h4 id="wd-dest" class="text-xl font-black text-primary tracking-tight">Not Configured</h4>
                    <p class="text-[11px] text-gray-500 mt-3 font-bold uppercase tracking-widest">Update identity in Terminal Settings</p>
                </div>

                <button onclick="submitWithdraw()" class="w-full bg-danger text-white font-black py-6 rounded-2xl shadow-[0_20px_40px_rgba(255,68,68,0.2)] text-xl">INITIALIZE LIQUIDATION</button>
            </div>
        </div>
    </div>

    <!-- Modal: Crypto Asset Terminal -->
    <div id="modal-crypto" class="fixed inset-0 z-[1000] bg-black/98 backdrop-blur-3xl flex items-center justify-center p-6 hidden">
        <div class="glass-card w-full max-w-6xl p-12 rounded-[48px] border-primary/20 relative overflow-y-auto max-h-[95vh]">
            <button onclick="closeModal('crypto')" class="absolute top-10 right-10 text-gray-500 hover:text-danger text-4xl transition-all">&times;</button>
            
            <div class="flex flex-col lg:flex-row lg:items-center gap-10 mb-16">
                <img id="cm-icon" src="" class="w-24 h-24 rounded-full border-4 border-primary/20">
                <div>
                    <h2 id="cm-name" class="text-6xl font-black tracking-tighter">Bitcoin</h2>
                    <p id="cm-sym" class="text-gray-500 font-mono text-2xl uppercase font-bold tracking-[5px]">BTC</p>
                </div>
                <div class="lg:ml-auto text-center lg:text-right">
                    <h2 id="cm-price" class="text-6xl font-black font-mono tracking-tighter mb-2">$0.00</h2>
                    <p id="cm-change" class="text-primary font-black text-2xl">+0.00%</p>
                </div>
            </div>

            <!-- Professional Trading Chart -->
            <div class="bg-black/40 rounded-[40px] p-10 border border-white/5 mb-16 h-[450px]">
                <canvas id="cm-chart"></canvas>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="space-y-10">
                    <h3 class="font-black text-3xl border-b border-white/5 pb-6">Institutional Metrics</h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div class="p-8 bg-white/5 rounded-3xl border border-white/5">
                            <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-3">Market Cap</p>
                            <p id="cm-cap" class="font-mono font-black text-xl tracking-tight">$0.00</p>
                        </div>
                        <div class="p-8 bg-white/5 rounded-3xl border border-white/5">
                            <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-3">24h Trade Volume</p>
                            <p id="cm-vol" class="font-mono font-black text-xl tracking-tight">$0.00</p>
                        </div>
                        <div class="p-8 bg-white/5 rounded-3xl border border-white/5">
                            <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-3">Institutional High</p>
                            <p id="cm-high" class="font-mono font-black text-xl text-primary tracking-tight">$0.00</p>
                        </div>
                        <div class="p-8 bg-white/5 rounded-3xl border border-white/5">
                            <p class="text-[11px] text-gray-500 font-bold uppercase tracking-[4px] mb-3">Institutional Low</p>
                            <p id="cm-low" class="font-mono font-black text-xl text-danger tracking-tight">$0.00</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-10">
                    <h3 class="font-black text-3xl border-b border-white/5 pb-6">Execute Institutional Order</h3>
                    <div class="space-y-8">
                        <div>
                            <label class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4 block">Acquisition Protocol</label>
                            <select id="cm-buy-type" class="w-full bg-black/40 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none font-bold text-lg">
                                <option value="direct">Direct Institutional Acquisition</option>
                                <option value="etf">ETF-Backed Synthetic Bridge</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[11px] font-bold text-gray-500 uppercase tracking-[4px] mb-4 block">Asset Value (USD)</label>
                            <input type="number" id="cm-buy-amt" class="w-full bg-black/40 border border-white/10 rounded-2xl px-6 py-5 focus:border-primary outline-none text-3xl font-mono font-black tracking-tighter" placeholder="$100.00">
                        </div>
                        <button onclick="executeOrder()" class="w-full bg-primary text-black font-black py-6 rounded-2xl neo-glow text-xl">EXECUTE MARKET ORDER</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CORE SYSTEM ENGINE SCRIPT -->
    <script>
        /**
         * ETF ELITE TERMINAL CORE v5.1.0 - UPGRADED MOBILE + NAV FIX
         * Institutional Trading & Asset Management Engine
         */

        // 1. INITIALIZATION & FIREBASE SYNC
        const firebaseConfig = {
            apiKey: "AIzaSyBvObxADcAior6R_or9O6UmWsFT8do1GkI",
            authDomain: "sqladmin-ff04d.firebaseapp.com",
            projectId: "sqladmin-ff04d",
            storageBucket: "sqladmin-ff04d.firebasestorage.app",
            messagingSenderId: "539086978850",
            appId: "1:539086978850:web:261e6a0cf3c9a2aa29ef7b"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Global Application State Matrix
        const State = {
            user: null,
            userData: null,
            admin: {},
            market: [],
            currentPage: 0,
            coinsPerPage: 40,
            selectedCoin: null,
            chart: null,
            payMethod: 'upi',
            isSyncing: false
        };

        // 2. AUTHENTICATION ENGINE
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                State.user = user;
                await initializeTerminal();
            } else {
                showView('auth');
                hideLoader();
            }
        });

        function toggleAuth(pane) {
            document.getElementById('login-pane').classList.toggle('hidden', pane !== 'login');
            document.getElementById('reg-pane').classList.toggle('hidden', pane !== 'reg');
        }

        async function handleAuth(type) {
            showLoader();
            try {
                if (type === 'register') {
                    const name = document.getElementById('reg-name').value.trim();
                    const phone = document.getElementById('reg-phone').value.trim();
                    const pass = document.getElementById('reg-pass').value;
                    const confirm = document.getElementById('reg-confirm').value;

                    if (!name || !phone || pass !== confirm || pass.length < 6) throw new Error("Operator Validation Failed.");
                    
                    const email = `${phone.replace(/\s+/g, '')}@sql-elite.com`;
                    const cred = await auth.createUserWithEmailAndPassword(email, pass);
                    
                    const refCode = 'SQL' + Math.random().toString(36).substr(2, 6).toUpperCase();
                    const referredBy = new URLSearchParams(window.location.search).get('ref') || '';

                    await db.collection('users').doc(cred.user.uid).set({
                        uid: cred.user.uid,
                        name, phone, email,
                        balance: 0, profit: 0, loss: 0, totalInvested: 0,
                        referralCode: refCode, referredBy,
                        refCount: 0, refEarned: 0,
                        upi: '', crypto: '', pfp: '',
                        role: 'operator',
                        joinedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    const phone = document.getElementById('login-phone').value.trim();
                    const pass = document.getElementById('login-pass').value;
                    const email = `${phone.replace(/\s+/g, '')}@sql-elite.com`;
                    await auth.signInWithEmailAndPassword(email, pass);
                }
            } catch (e) {
                alert("Terminal Error: " + e.message);
            } finally {
                hideLoader();
            }
        }

        function handleLogout() {
            auth.signOut().then(() => location.reload());
        }

        // 3. TERMINAL INITIALIZATION PROTOCOL
        async function initializeTerminal() {
            // Real-time Identity Sync
            db.collection('users').doc(State.user.uid).onSnapshot(doc => {
                if (doc.exists) {
                    State.userData = doc.data();
                    updateUserInterface();
                }
            });

            // Global Parameters Sync
            db.collection('admin').doc('config').onSnapshot(doc => {
                if (doc.exists) {
                    State.admin = doc.data();
                    applyGlobalConfig();
                }
            });

            // Initialize High-Frequency Market Feed
            await syncMarketData();
            setInterval(syncMarketData, 20000); // Institutional Refresh Rate
            
            // Load Content Baskets
            syncTerminalContent();
            
            // Activate App Shell
            showView('app');
            hideLoader();

            // Set initial mobile nav active
            document.querySelector('.mobile-nav-btn[data-page="home"]').classList.add('active');
        }

        function updateUserInterface() {
            const d = State.userData || {};
            document.getElementById('user-greeting').innerText = d.name || 'Operator';
            document.getElementById('user-name-side').innerText = d.name || 'Operator';
            document.getElementById('prof-name').innerText = d.name || 'Operator';
            document.getElementById('prof-phone').innerText = d.phone || '+91 00000 00000';
            
            if (d.pfp) {
                document.getElementById('user-pfp-side').src = d.pfp;
                document.getElementById('prof-pfp').src = d.pfp;
            }

            const format = (v) => '₹' + (v || 0).toLocaleString('en-IN', { minimumFractionDigits: 2 });
            document.getElementById('bal-total').innerText = format((d.balance || 0) + (d.totalInvested || 0));
            document.getElementById('bal-invested').innerText = format(d.totalInvested || 0);
            document.getElementById('bal-profit').innerText = format(d.profit || 0);
            document.getElementById('wallet-total-val').innerText = format((d.balance || 0) + (d.totalInvested || 0));
            document.getElementById('wd-max').innerText = format(d.balance || 0);

            document.getElementById('prof-upi').value = d.upi || '';
            document.getElementById('prof-crypto').value = d.crypto || '';
            document.getElementById('wd-dest').innerText = d.upi || d.crypto || 'Not Configured';

            // Referral Network Data
            document.getElementById('ref-count').innerText = d.refCount || 0;
            document.getElementById('ref-earned').innerText = format(d.refEarned || 0);
            document.getElementById('ref-link-input').value = `${window.location.origin}?ref=${d.referralCode || 'SQLXXXXXX'}`;

            loadTransactionLogs();
        }

        function applyGlobalConfig() {
            const a = State.admin || {};
            if (a.siteName) {
                document.title = a.siteName + " | Elite Terminal";
            }
            if (a.pColor) document.documentElement.style.setProperty('--primary', a.pColor);
            if (a.sColor) document.documentElement.style.setProperty('--secondary', a.sColor);

            document.getElementById('disp-adm-upi').innerText = a.upi || 'OFFLINE';
            document.getElementById('disp-adm-btc').innerText = a.btc || 'OFFLINE';
            document.getElementById('disp-adm-eth').innerText = a.eth || 'OFFLINE';
            document.getElementById('upi-link').href = `upi://pay?pa=${a.upi || ''}&pn=SQL%20ELITE&cu=INR`;

            // Support Infrastructure
            const supBox = document.getElementById('support-line-container');
            supBox.innerHTML = '';
            (a.support || ["+91 00000 00000"]).forEach(num => {
                const wa = `https://wa.me/${num.replace(/\D/g,'')}?text=${encodeURIComponent('ETF WEBSITE से आया है: I need institutional support.')}`;
                supBox.innerHTML += `
                    <a href="${wa}" target="_blank" class="glass-card p-8 rounded-3xl flex items-center justify-between group hover:border-primary/40 transition-all">
                        <div class="flex items-center gap-6">
                            <i class="fab fa-whatsapp text-4xl text-primary"></i>
                            <div class="text-left">
                                <h4 class="font-black text-lg">Support Manager</h4>
                                <p class="text-gray-500 font-mono font-bold">${num}</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-700 group-hover:text-primary transition-all"></i>
                    </a>
                `;
            });
        }

        // 4. MARKET TERMINAL ENGINE (1000+ COINS)
        async function syncMarketData() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&sparkline=true&price_change_percentage=24h');
                State.market = await res.json();
                renderMarketTerminal();
                updateMarketSidebar();
                
                if (State.market.length > 0) {
                    document.getElementById('market-price-ticker').innerText = '$' + State.market[0].current_price.toLocaleString();
                }
            } catch (e) {
                console.error("Market Feed Latency Detected.");
            }
        }

        function renderMarketTerminal() {
            const tbody = document.getElementById('market-list-body');
            const search = (document.getElementById('market-search').value || '').toLowerCase();
            tbody.innerHTML = '';

            const filtered = State.market.filter(c => 
                (c.name || '').toLowerCase().includes(search) || 
                (c.symbol || '').toLowerCase().includes(search)
            );
            
            filtered.slice(0, (State.currentPage + 1) * State.coinsPerPage).forEach(coin => {
                const tr = document.createElement('tr');
                tr.className = 'market-row cursor-pointer';
                tr.onclick = () => openAssetTerminal(coin);
                
                const change = coin.price_change_percentage_24h || 0;
                
                tr.innerHTML = `
                    <td class="p-6 lg:p-8">
                        <div class="flex items-center gap-5">
                            <img src="${coin.image}" class="w-10 h-10 rounded-full border border-white/10">
                            <div>
                                <p class="font-black text-lg tracking-tight">${coin.name}</p>
                                <p class="text-[11px] text-gray-500 font-mono font-bold uppercase tracking-widest">${coin.symbol}</p>
                            </div>
                        </div>
                    </td>
                    <td class="p-6 lg:p-8 font-mono font-black text-lg">$${coin.current_price.toLocaleString()}</td>
                    <td class="p-6 lg:p-8">
                        <span class="px-4 py-2 rounded-xl text-[11px] font-black tracking-widest ${change >= 0 ? 'bg-primary/10 text-primary border border-primary/20' : 'bg-danger/10 text-danger border border-danger/20'}">
                            ${change >= 0 ? '+' : ''}${change.toFixed(2)}%
                        </span>
                    </td>
                    <td class="p-6 lg:p-8 text-gray-500 font-mono font-bold text-sm">$${(coin.market_cap / 1e9).toFixed(2)}B</td>
                    <td class="p-6 lg:p-8 text-right">
                        <button class="bg-primary/10 text-primary border border-primary/20 px-6 py-3 rounded-2xl text-[11px] font-black hover:bg-primary hover:text-black transition-all tracking-widest">TRADE</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function loadMoreCoins() {
            State.currentPage++;
            renderMarketTerminal();
        }

        document.getElementById('market-search').addEventListener('input', renderMarketTerminal);

        function openAssetTerminal(coin) {
            State.selectedCoin = coin;
            document.getElementById('cm-icon').src = coin.image;
            document.getElementById('cm-name').innerText = coin.name;
            document.getElementById('cm-sym').innerText = coin.symbol.toUpperCase();
            document.getElementById('cm-price').innerText = '$' + coin.current_price.toLocaleString();
            
            const change = coin.price_change_percentage_24h || 0;
            const el = document.getElementById('cm-change');
            el.innerText = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
            el.className = change >= 0 ? 'text-primary font-black text-2xl' : 'text-danger font-black text-2xl';

            document.getElementById('cm-cap').innerText = '$' + (coin.market_cap / 1e9).toFixed(2) + 'B';
            document.getElementById('cm-vol').innerText = '$' + (coin.total_volume / 1e6).toFixed(2) + 'M';
            document.getElementById('cm-high').innerText = '$' + coin.high_24h.toLocaleString();
            document.getElementById('cm-low').innerText = '$' + coin.low_24h.toLocaleString();

            openModal('crypto');
            renderInstitutionalChart(coin);
        }

        function renderInstitutionalChart(coin) {
            const ctx = document.getElementById('cm-chart').getContext('2d');
            if (State.chart) State.chart.destroy();

            const spark = coin.sparkline_in_7d.price;
            const labels = spark.map((_, i) => i);

            State.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        data: spark,
                        borderColor: '#00ff88',
                        borderWidth: 3,
                        pointRadius: 0,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: (context) => {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return null;
                            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
                            gradient.addColorStop(0, 'rgba(0, 255, 136, 0)');
                            gradient.addColorStop(1, 'rgba(0, 255, 136, 0.15)');
                            return gradient;
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        function updateMarketSidebar() {
            const trendBox = document.getElementById('market-trending');
            trendBox.innerHTML = '';
            State.market.slice(0, 5).forEach(coin => {
                trendBox.innerHTML += `
                    <div class="flex items-center justify-between p-4 bg-black/30 rounded-2xl border border-white/5 group hover:border-primary/20 transition-all cursor-pointer" onclick="openAssetTerminal(${JSON.stringify(coin).replace(/"/g, '&quot;')})">
                        <div class="flex items-center gap-4">
                            <img src="${coin.image}" class="w-8 h-8 rounded-full">
                            <span class="font-black text-sm tracking-widest">${coin.symbol.toUpperCase()}</span>
                        </div>
                        <span class="text-primary font-mono text-sm font-black">$${coin.current_price.toLocaleString()}</span>
                    </div>
                `;
            });

            const newsBox = document.getElementById('market-news');
            const mockIntel = [
                { title: "Institutional Whale Movement Detected in BTC", time: "3m ago", type: "Alert" },
                { title: "ETF Inflow Surges to Record High in Q1 2026", time: "18m ago", type: "Market" },
                { title: "SQL Elite Liquidity Bridge Expansion Complete", time: "1h ago", type: "System" }
            ];
            newsBox.innerHTML = '';
            mockIntel.forEach(n => {
                newsBox.innerHTML += `
                    <div class="border-l-4 border-primary/20 pl-5 group cursor-pointer">
                        <span class="text-[10px] font-black text-primary uppercase tracking-[4px] mb-2 block">${n.type}</span>
                        <h4 class="font-black text-lg mb-2 group-hover:text-primary transition-all">${n.title}</h4>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">${n.time}</p>
                    </div>
                `;
            });
        }

        // 5. ASSET & CONTENT BASKETS
        function syncTerminalContent() {
            // Demo data since DB may be empty - you can replace with real Firestore later
            const demoFeatured = [
                { id: 'f1', type: 'featured', title: 'BTC Elite Vault', desc: 'High yield Bitcoin backed institutional portfolio.', img: 'https://picsum.photos/id/1015/800/600', roi: 28, min: 5000 },
                { id: 'f2', type: 'featured', title: 'ETH Growth Fund', desc: 'Diversified Ethereum + Layer-2 staking basket.', img: 'https://picsum.photos/id/201/800/600', roi: 42, min: 10000 }
            ];
            const demoPlans = [
                { id: 'p1', type: 'plan', title: 'Quantum ETF Basket', desc: 'AI + Quantum computing themed ETFs.', img: 'https://picsum.photos/id/237/800/600', roi: 19, min: 25000 },
                { id: 'p2', type: 'plan', title: 'Green Energy Crypto', desc: 'Sustainable blockchain + renewable energy.', img: 'https://picsum.photos/id/870/800/600', roi: 35, min: 15000 }
            ];

            const featGrid = document.getElementById('featured-grid');
            const planGrid = document.getElementById('invest-plans-grid');
            featGrid.innerHTML = ''; planGrid.innerHTML = '';

            demoFeatured.forEach(c => featGrid.appendChild(createAssetCard(c)));
            demoPlans.forEach(c => planGrid.appendChild(createAssetCard(c)));
        }

        function createAssetCard(c) {
            const div = document.createElement('div');
            div.className = 'glass-card rounded-[32px] overflow-hidden group hover:border-primary/40 transition-all duration-500';
            div.innerHTML = `
                <div class="h-60 overflow-hidden relative">
                    <img src="${c.img}" class="w-full h-full object-cover group-hover:scale-110 transition-all duration-1000">
                    <div class="absolute top-6 left-6 bg-primary text-black px-5 py-2 rounded-full text-[11px] font-black tracking-[4px] uppercase neo-glow">${c.roi}% ROI</div>
                </div>
                <div class="p-10">
                    <h3 class="text-2xl font-black mb-5 tracking-tight">${c.title}</h3>
                    <p class="text-gray-500 text-sm font-medium mb-10 leading-relaxed">${c.desc}</p>
                    <div class="grid grid-cols-2 gap-6 mb-10 bg-black/30 p-6 rounded-2xl border border-white/5">
                        <div><p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mb-2">Min Stake</p><p class="font-mono font-black text-primary text-xl">₹${c.min}</p></div>
                        <div><p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mb-2">Duration</p><p class="font-mono font-black text-primary text-xl">30 Days</p></div>
                    </div>
                    <button onclick="openModal('deposit', ${c.min})" class="w-full bg-white/5 border border-primary/30 text-primary font-black py-5 rounded-2xl hover:bg-primary hover:text-black transition-all text-lg tracking-widest">INVEST NOW</button>
                </div>
            `;
            return div;
        }

        // 6. SETTLEMENT & LIQUIDATION
        async function submitDeposit() {
            const amt = parseFloat(document.getElementById('dep-amt').value);
            const ref = document.getElementById('dep-ref').value.trim();
            if (!amt || !ref) return alert("All settlement fields are mandatory.");

            try {
                showLoader();
                await db.collection('transactions').add({
                    uid: State.user.uid,
                    userName: State.userData.name,
                    amount: amt,
                    ref, type: 'deposit',
                    method: State.payMethod,
                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Settlement Logged. Awaiting verification on the ledger.");
                closeModal('deposit');
            } catch (e) { alert("Bridge Error: " + e.message); }
            finally { hideLoader(); }
        }

        async function submitWithdraw() {
            const amt = parseFloat(document.getElementById('wd-amt').value);
            if (!amt || amt > (State.userData.balance || 0)) return alert("Invalid liquidation value.");

            try {
                showLoader();
                await db.collection('transactions').add({
                    uid: State.user.uid,
                    userName: State.userData.name,
                    amount: amt,
                    type: 'withdrawal',
                    dest: State.userData.upi || State.userData.crypto,
                    status: 'pending',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Liquidation bridge initialized. Assets will be released shortly.");
                closeModal('withdraw');
            } catch (e) { alert("Bridge Error: " + e.message); }
            finally { hideLoader(); }
        }

        function loadTransactionLogs() {
            db.collection('transactions').where('uid', '==', State.user.uid).orderBy('timestamp', 'desc').limit(15).onSnapshot(snap => {
                const homeList = document.getElementById('home-tx-list');
                const walletList = document.getElementById('wallet-tx-body');
                homeList.innerHTML = ''; walletList.innerHTML = '';

                snap.forEach(doc => {
                    const tx = doc.data();
                    const date = tx.timestamp ? tx.timestamp.toDate().toLocaleString('en-IN') : 'Processing...';
                    const row = `
                        <tr class="border-b border-white/5 hover:bg-white/2 transition-all">
                            <td class="py-6 font-mono text-xs text-gray-500">${date}</td>
                            <td class="py-6 font-black uppercase text-xs tracking-widest">${tx.type}</td>
                            <td class="py-6 font-mono font-black text-lg ${tx.type === 'deposit' ? 'text-primary' : 'text-danger'}">₹${tx.amount.toLocaleString()}</td>
                            <td class="py-6 text-right"><span class="px-4 py-2 rounded-xl text-[10px] font-black tracking-[4px] bg-white/5 text-secondary border border-secondary/20">${tx.status.toUpperCase()}</span></td>
                        </tr>
                    `;
                    homeList.innerHTML += row;
                    walletList.innerHTML += row;
                });
            });
        }

        // 7. UTILITY & NAVIGATION MODULES (FIXED FOR MOBILE + DESKTOP SYNC)
        function switchPage(pageId, el = null) {
            // Switch pages
            document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
            const targetView = document.getElementById('view-' + pageId);
            if (targetView) targetView.classList.add('active');

            // Desktop sidebar active
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            if (el && el.classList.contains('nav-link')) {
                el.classList.add('active');
            }

            // Mobile bottom nav active (sync)
            document.querySelectorAll('.mobile-nav-btn').forEach(b => b.classList.remove('active'));
            const mobileBtn = document.querySelector(`.mobile-nav-btn[data-page="${pageId}"]`);
            if (mobileBtn) mobileBtn.classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Wallet Tab Switch (MISSING FUNCTION FIXED)
        function switchWalletTab(tab, el) {
            document.querySelectorAll('.wallet-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');

            document.getElementById('wallet-pane-tx').classList.add('hidden');
            document.getElementById('wallet-pane-holdings').classList.add('hidden');

            if (tab === 'tx') {
                document.getElementById('wallet-pane-tx').classList.remove('hidden');
            } else if (tab === 'holdings') {
                const holdingsDiv = document.getElementById('wallet-pane-holdings');
                holdingsDiv.classList.remove('hidden');
                holdingsDiv.innerHTML = `
                    <div class="glass-card p-8 rounded-3xl text-center">
                        <p class="text-gray-400">Demo Holdings: BTC ₹45,000 | ETH ₹28,000 | USDT ₹12,000</p>
                    </div>
                `;
            }
        }

        function openModal(id, val = null) {
            if (val !== null) document.getElementById('dep-amt').value = val;
            document.getElementById('modal-' + id).classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(id) {
            document.getElementById('modal-' + id).classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function showLoader() { 
            document.getElementById('master-loader').classList.remove('hidden'); 
        }
        function hideLoader() { 
            document.getElementById('master-loader').classList.add('hidden'); 
        }

        function showView(v) {
            document.getElementById('auth-view').classList.toggle('hidden', v !== 'auth');
            document.getElementById('app-shell').classList.toggle('hidden', v !== 'app');
        }

        function setDep(v) { 
            document.getElementById('dep-amt').value = v; 
        }

        function switchPay(opt) {
            State.payMethod = opt;
            document.querySelectorAll('.pay-tab').forEach(t => t.classList.remove('active', 'border-primary/20'));
            document.getElementById('pay-btn-' + opt).classList.add('active', 'border-primary/20');
            document.getElementById('pane-upi').classList.toggle('hidden', opt !== 'upi');
            document.getElementById('pane-crypto').classList.toggle('hidden', opt !== 'crypto');
        }

        async function saveProfileSettings() {
            const upi = document.getElementById('prof-upi').value.trim();
            const crypto = document.getElementById('prof-crypto').value.trim();
            try {
                showLoader();
                await db.collection('users').doc(State.user.uid).update({ upi, crypto });
                alert("Terminal Identity Updated.");
            } catch (e) { alert(e.message); }
            finally { hideLoader(); }
        }

        // MISSING PFP UPLOAD FUNCTION ADDED (Base64 demo for single file)
        function handlePfpUpload(input) {
            if (!input.files || !input.files[0]) return;
            showLoader();
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = async function(e) {
                const url = e.target.result;
                try {
                    await db.collection('users').doc(State.user.uid).update({ pfp: url });
                    document.getElementById('prof-pfp').src = url;
                    document.getElementById('user-pfp-side').src = url;
                    alert('Profile Picture Updated Successfully!');
                } catch (err) {
                    alert('Upload Error: ' + err.message);
                } finally {
                    hideLoader();
                }
            };
            reader.readAsDataURL(file);
        }

        function copyRefLink() {
            const input = document.getElementById('ref-link-input');
            input.select();
            document.execCommand('copy');
            alert("Elite Invite Link Copied to Clipboard.");
        }

        function shareRefWA() {
            const link = document.getElementById('ref-link-input').value;
            const msg = `ETF ELITE TERMINAL: Access institutional grade investment portfolios. Join my network: ${link}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
        }

        function executeOrder() {
            alert("Institutional Order Executed Successfully! (Demo)");
            closeModal('crypto');
        }

        // Clock Update
        setInterval(() => {
            const now = new Date();
            document.getElementById('global-timer').innerText = now.toISOString().split('T')[1].split('.')[0] + " UTC";
        }, 1000);

        // Initial call for demo wallet holdings (optional)
        window.onload = () => {
            // If needed, pre-load demo holdings here
        };
    </script>
</body>
                </html>
